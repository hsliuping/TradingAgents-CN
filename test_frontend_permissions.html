<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·æƒé™æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #1890ff;
        }
        .admin-only {
            border-left-color: #52c41a;
            background: #f6ffed;
        }
        .user-only {
            border-left-color: #faad14;
            background: #fffbe6;
        }
        .code {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        .success {
            color: #52c41a;
            font-weight: bold;
        }
        .warning {
            color: #faad14;
            font-weight: bold;
        }
        .error {
            color: #ff4d4f;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ ç”¨æˆ·æƒé™æ§åˆ¶ç³»ç»Ÿæµ‹è¯•</h1>

    <div class="test-section">
        <h2>ğŸ“‹ æƒé™è§„åˆ™è¯´æ˜</h2>
        <p><strong>ç³»ç»Ÿè®¾è®¡åŸåˆ™ï¼š</strong></p>
        <ul>
            <li>âœ… <strong>adminç”¨æˆ·</strong>ï¼šè¶…çº§ç®¡ç†å‘˜ï¼Œå¯è®¿é—®æ‰€æœ‰é¡µé¢å’ŒåŠŸèƒ½</li>
            <li>ğŸ‘¤ <strong>æ™®é€šç”¨æˆ·</strong>ï¼šæ‰€æœ‰å…¶ä»–æ³¨å†Œç”¨æˆ·ï¼Œåªèƒ½è®¿é—®åŸºç¡€åŠŸèƒ½</li>
            <li>ğŸš« <strong>æƒé™é™åˆ¶</strong>ï¼šæ™®é€šç”¨æˆ·æ— æ³•è®¿é—®ç³»ç»Ÿè®¾ç½®å’Œç³»ç»Ÿç®¡ç†é¡µé¢</li>
        </ul>
    </div>

    <div class="test-section admin-only">
        <h2>ğŸ‘‘ ç®¡ç†å‘˜æƒé™æµ‹è¯• (adminç”¨æˆ·)</h2>
        <p><span class="success">âœ“ å¯è®¿é—®</span> ä»¥ä¸‹æ‰€æœ‰é¡µé¢å’ŒåŠŸèƒ½ï¼š</p>
        <div class="code">
# ç”¨æˆ·ä¸ªäººè®¾ç½®
GET /settings?tab=general
GET /settings?tab=appearance
GET /settings?tab=analysis
GET /settings?tab=notifications
GET /settings?tab=security

# ç³»ç»Ÿé…ç½®ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
GET /settings/config
GET /settings/config?tab=config
GET /settings/config?tab=usage
GET /settings/config?tab=cache

# ç³»ç»Ÿç®¡ç†ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
GET /settings/database
GET /settings/logs
GET /settings/sync
GET /settings/system-logs

# APIæ¥å£
GET /api/auth/users           # è·å–ç”¨æˆ·åˆ—è¡¨
POST /api/auth/create-user    # åˆ›å»ºç”¨æˆ·
DELETE /api/auth/users/:id   # åˆ é™¤ç”¨æˆ·
        </div>
        <p class="success">âœ… æµ‹è¯•é¢„æœŸï¼šæ‰€æœ‰ä¸Šè¿°è¯·æ±‚éƒ½åº”è¯¥è¿”å› 200 æˆåŠŸçŠ¶æ€</p>
    </div>

    <div class="test-section user-only">
        <h2>ğŸ‘¤ æ™®é€šç”¨æˆ·æƒé™æµ‹è¯• (éadminç”¨æˆ·)</h2>
        <p><span class="success">âœ“ å¯è®¿é—®</span> ä¸ªäººè®¾ç½®é¡µé¢ï¼š</p>
        <div class="code">
# ç”¨æˆ·ä¸ªäººè®¾ç½®
GET /settings?tab=general
GET /settings?tab=appearance
GET /settings?tab=analysis
GET /settings?tab=notifications
GET /settings?tab=security
        </div>

        <p><span class="error">âœ— æ— æ³•è®¿é—®</span> ç³»ç»Ÿé…ç½®é¡µé¢ï¼š</p>
        <div class="code">
# ç³»ç»Ÿé…ç½®ï¼ˆä»…ç®¡ç†å‘˜ï¼‰- åº”è¯¥è¿”å› 403 æˆ–é‡å®šå‘
GET /settings/config
GET /settings/config?tab=config
GET /settings/config?tab=usage
GET /settings/config?tab=cache

# ç³»ç»Ÿç®¡ç†ï¼ˆä»…ç®¡ç†å‘˜ï¼‰- åº”è¯¥è¿”å› 403 æˆ–é‡å®šå‘
GET /settings/database
GET /settings/logs
GET /settings/sync
GET /settings/system-logs
        </div>

        <p><span class="error">âœ— æ— æ³•è®¿é—®</span> ç®¡ç†å‘˜APIï¼š</p>
        <div class="code">
# ç®¡ç†å‘˜APIæ¥å£ - åº”è¯¥è¿”å› 403 Forbidden
GET /api/auth/users
POST /api/auth/create-user
DELETE /api/auth/users/:id
        </div>

        <p class="success">âœ… æµ‹è¯•é¢„æœŸï¼šä¸ªäººè®¾ç½®è¿”å›200ï¼Œç³»ç»Ÿå’Œç®¡ç†åŠŸèƒ½è¿”å›403æˆ–é‡å®šå‘</p>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª å®é™…æµ‹è¯•æ­¥éª¤</h2>

        <h3>æ­¥éª¤1ï¼šæµ‹è¯•adminç”¨æˆ·</h3>
        <ol>
            <li>ä½¿ç”¨adminç”¨æˆ·ç™»å½•</li>
            <li>è®¿é—® <code>/settings</code> é¡µé¢</li>
            <li>éªŒè¯å¯ä»¥çœ‹åˆ°æ‰€æœ‰èœå•ï¼šä¸ªäººè®¾ç½®ã€ç³»ç»Ÿé…ç½®ã€ç³»ç»Ÿç®¡ç†</li>
            <li>ç‚¹å‡»å„ä¸ªèœå•é¡¹ï¼ŒéªŒè¯éƒ½èƒ½æ­£å¸¸è®¿é—®</li>
            <li>æµ‹è¯•APIæ¥å£ <code>/api/auth/users</code> åº”è¿”å›ç”¨æˆ·åˆ—è¡¨</li>
        </ol>

        <h3>æ­¥éª¤2ï¼šæµ‹è¯•æ™®é€šç”¨æˆ·</h3>
        <ol>
            <li>æ³¨å†Œæ–°ç”¨æˆ·æˆ–ä½¿ç”¨ç°æœ‰æ™®é€šç”¨æˆ·ç™»å½•</li>
            <li>è®¿é—® <code>/settings</code> é¡µé¢</li>
            <li>éªŒè¯<strong>åªèƒ½çœ‹åˆ°</strong>ä¸ªäººè®¾ç½®èœå•</li>
            <li>å°è¯•ç›´æ¥è®¿é—® <code>/settings/config</code>ï¼Œåº”è¯¥è¢«é‡å®šå‘æˆ–æ˜¾ç¤ºæƒé™ä¸è¶³</li>
            <li>å°è¯•ç›´æ¥è®¿é—® <code>/settings/database</code>ï¼Œåº”è¯¥è¢«é‡å®šå‘æˆ–æ˜¾ç¤ºæƒé™ä¸è¶³</li>
            <li>æµ‹è¯•APIæ¥å£ <code>/api/auth/users</code> åº”è¿”å›403é”™è¯¯</li>
        </ol>

        <h3>æ­¥éª¤3ï¼šæµ‹è¯•URLç›´æ¥è®¿é—®</h3>
        <p>æµ‹è¯•æ™®é€šç”¨æˆ·ç›´æ¥é€šè¿‡URLè®¿é—®ç®¡ç†å‘˜é¡µé¢ï¼š</p>
        <div class="code">
# æ™®é€šç”¨æˆ·æµ‹è¯•
1. ç™»å½•æ™®é€šç”¨æˆ·è´¦æˆ·
2. ç›´æ¥åœ¨æµè§ˆå™¨è¾“å…¥ï¼šhttp://localhost:3000/settings/config
3. é¢„æœŸç»“æœï¼šé‡å®šå‘åˆ° /settings?tab=profile æˆ–æ˜¾ç¤ºæƒé™ä¸è¶³æ¶ˆæ¯
4. ç›´æ¥åœ¨æµè§ˆå™¨è¾“å…¥ï¼šhttp://localhost:3000/settings/database
5. é¢„æœŸç»“æœï¼šé‡å®šå‘åˆ° /dashboard æˆ–æ˜¾ç¤ºæƒé™ä¸è¶³æ¶ˆæ¯
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ æŠ€æœ¯å®ç°éªŒè¯</h2>

        <h3>åç«¯æƒé™æ§åˆ¶</h3>
        <p>éªŒè¯ä»¥ä¸‹åç«¯é€»è¾‘ï¼š</p>
        <div class="code">
# 1. ç”¨æˆ·åˆ›å»ºé»˜è®¤æƒé™
is_admin: False  # æ–°ç”¨æˆ·é»˜è®¤ä¸æ˜¯ç®¡ç†å‘˜

# 2. æƒé™æ£€æŸ¥è£…é¥°å™¨
@router.get("/users")
async def list_users(user=Depends(get_current_user)):
    if not user.get("is_admin", False):
        raise HTTPException(status_code=403, detail="æƒé™ä¸è¶³")
    # åªæœ‰ç®¡ç†å‘˜å¯æ‰§è¡Œ

# 3. ç”¨æˆ·è®¤è¯è¿”å›
return {
    "id": str(user.id),
    "username": user.username,
    "is_admin": user.is_admin,  # å…³é”®å­—æ®µ
    "roles": ["admin"] if user.is_admin else ["user"]
}
        </div>

        <h3>å‰ç«¯æƒé™æ§åˆ¶</h3>
        <p>éªŒè¯ä»¥ä¸‹å‰ç«¯é€»è¾‘ï¼š</p>
        <div class="code">
# 1. è·¯ç”±å®ˆå«
router.beforeEach((to, from, next) => {
  const systemAdminRoutes = ['ConfigManagement', 'DatabaseManagement', 'OperationLogs']

  if (systemAdminRoutes.includes(to.name) && !authStore.isAdmin) {
    ElMessage.warning('æ‚¨æ²¡æœ‰æƒé™è®¿é—®æ­¤é¡µé¢')
    next('/dashboard')
    return
  }
})

# 2. èœå•æ˜¾ç¤ºæ§åˆ¶
&lt;template v-if="currentSection === 'config' && authStore.isAdmin"&gt;
  &lt;!-- ç³»ç»Ÿé…ç½®èœå• --&gt;
&lt;/template&gt;

# 3. é¡µé¢å†…å®¹æ§åˆ¶
&lt;el-card v-show="activeTab === 'config' && authStore.isAdmin"&gt;
  &lt;!-- é…ç½®ç®¡ç†å†…å®¹ --&gt;
&lt;/el-card&gt;
        </div>
    </div>

    <div class="test-section">
        <h2>âœ… éªŒè¯æ¸…å•</h2>
        <p><strong>å®Œæˆä»¥ä¸‹æ£€æŸ¥ç¡®è®¤æƒé™æ§åˆ¶æ­£å¸¸å·¥ä½œï¼š</strong></p>

        <h3>æ•°æ®å±‚é¢</h3>
        <ul>
            <li>â˜ æ•°æ®åº“ä¸­åªæœ‰adminç”¨æˆ·çš„is_adminå­—æ®µä¸ºTrue</li>
            <li>â˜ æ‰€æœ‰å…¶ä»–ç”¨æˆ·çš„is_adminå­—æ®µä¸ºFalse</li>
            <li>â˜ æ–°æ³¨å†Œç”¨æˆ·é»˜è®¤is_adminä¸ºFalse</li>
        </ul>

        <h3>åç«¯API</h3>
        <ul>
            <li>â˜ /api/auth/me æ¥å£æ­£ç¡®è¿”å›is_adminå­—æ®µ</li>
            <li>â˜ ç®¡ç†å‘˜æ¥å£å¯¹æ™®é€šç”¨æˆ·è¿”å›403</li>
            <li>â˜ JWT tokenåŒ…å«æ­£ç¡®çš„ç”¨æˆ·è§’è‰²ä¿¡æ¯</li>
        </ul>

        <h3>å‰ç«¯UI</h3>
        <ul>
            <li>â˜ adminç”¨æˆ·èƒ½çœ‹åˆ°æ‰€æœ‰è®¾ç½®èœå•</li>
            <li>â˜ æ™®é€šç”¨æˆ·åªèƒ½çœ‹åˆ°ä¸ªäººè®¾ç½®èœå•</li>
            <li>â˜ ç›´æ¥è®¿é—®ç®¡ç†å‘˜URLä¼šè¢«é‡å®šå‘</li>
            <li>â˜ è·¯ç”±å®ˆå«æ­£ç¡®é˜»æ­¢æœªæˆæƒè®¿é—®</li>
        </ul>

        <h3>ç”¨æˆ·ä½“éªŒ</h3>
        <ul>
            <li>â˜ æƒé™ä¸è¶³æ—¶æœ‰å‹å¥½çš„æç¤ºä¿¡æ¯</li>
            <li>â˜ é‡å®šå‘é€»è¾‘åˆç†ï¼Œä¸ä¼šé€ æˆç”¨æˆ·å›°æƒ‘</li>
            <li>â˜ é¡µé¢åŠ è½½é€Ÿåº¦æ­£å¸¸ï¼Œæƒé™æ£€æŸ¥ä¸å½±å“æ€§èƒ½</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>ğŸš¨ å¸¸è§é—®é¢˜æ’æŸ¥</h2>

        <h3>é—®é¢˜1ï¼šæ™®é€šç”¨æˆ·èƒ½çœ‹åˆ°ç®¡ç†å‘˜èœå•</h3>
        <p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
        <ul>
            <li>authStore.isAdmin è®¡ç®—é”™è¯¯</li>
            <li>ç”¨æˆ·è§’è‰²ä¿¡æ¯æ²¡æœ‰æ­£ç¡®æ›´æ–°</li>
            <li>å‰ç«¯æƒé™æ§åˆ¶æ¡ä»¶æœ‰è¯¯</li>
        </ul>
        <p><strong>è§£å†³æ–¹æ³•ï¼š</strong>æ£€æŸ¥å‰ç«¯æ§åˆ¶å°ï¼Œç¡®è®¤ç”¨æˆ·è§’è‰²ä¿¡æ¯ï¼Œæ£€æŸ¥v-ifæ¡ä»¶</p>

        <h3>é—®é¢˜2ï¼šURLç›´æ¥è®¿é—®ç»•è¿‡æƒé™æ£€æŸ¥</h3>
        <p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
        <ul>
            <li>è·¯ç”±å®ˆå«é…ç½®æœ‰è¯¯</li>
            <li>å—æ§è·¯ç”±åç§°ä¸åŒ¹é…</li>
            <li>æƒé™æ£€æŸ¥é€»è¾‘æœ‰æ¼æ´</li>
        </ul>
        <p><strong>è§£å†³æ–¹æ³•ï¼š</strong>æ£€æŸ¥è·¯ç”±é…ç½®ï¼Œç¡®ä¿æ‰€æœ‰ç®¡ç†å‘˜è·¯ç”±éƒ½åœ¨systemAdminRoutesåˆ—è¡¨ä¸­</p>

        <h3>é—®é¢˜3ï¼šadminç”¨æˆ·è¢«è¯¯è®¤ä¸ºæ™®é€šç”¨æˆ·</h3>
        <p><strong>å¯èƒ½åŸå› ï¼š</strong></p>
        <ul>
            <li>æ•°æ®åº“ä¸­adminç”¨æˆ·çš„is_adminå­—æ®µä¸ºFalse</li>
            <li>JWT tokenä¸­æ²¡æœ‰åŒ…å«æ­£ç¡®çš„è§’è‰²ä¿¡æ¯</li>
            <li>å‰ç«¯è§’è‰²è§£æé€»è¾‘æœ‰è¯¯</li>
        </ul>
        <p><strong>è§£å†³æ–¹æ³•ï¼š</strong>è¿è¡Œæµ‹è¯•è„šæœ¬æ£€æŸ¥æ•°æ®åº“ï¼Œç¡®è®¤tokenå†…å®¹</p>
    </div>

    <footer style="text-align: center; margin-top: 40px; padding: 20px; border-top: 1px solid #eee;">
        <p>ğŸ¯ æƒé™æ§åˆ¶ç³»ç»Ÿæµ‹è¯•æŒ‡å— | ç¡®ä¿åªæœ‰adminæ˜¯è¶…çº§ç”¨æˆ·ï¼Œå…¶ä»–ç”¨æˆ·éƒ½æ˜¯æ™®é€šç”¨æˆ·</p>
    </footer>
</body>
</html>