# é˜¶æ®µå››ï¼šå›¾æ„å»ºä¸é›†æˆå¼€å‘æ–¹æ¡ˆ

## ğŸ“‹ é˜¶æ®µæ¦‚è¿°

**ç›®æ ‡**ï¼šæ„å»ºæŒ‡æ•°åˆ†æå·¥ä½œæµå›¾ï¼Œå¹¶é›†æˆåˆ°æ•´ä¸ªç³»ç»Ÿä¸­ï¼Œå®ç°å®Œæ•´çš„ç«¯åˆ°ç«¯æµç¨‹ã€‚

**é¢„è®¡æ—¶é—´**ï¼š2-3å¤©  
**ä¼˜å…ˆçº§**ï¼šğŸ”´ æœ€é«˜ï¼ˆç³»ç»Ÿé›†æˆï¼‰

**å‰ç½®æ¡ä»¶**ï¼š
- é˜¶æ®µä¸€ï¼ˆæ•°æ®å±‚ä¸å·¥å…·å±‚ï¼‰å·²å®Œæˆ
- é˜¶æ®µäºŒï¼ˆAgentèŠ‚ç‚¹å®ç°ï¼‰å·²å®Œæˆ
- é˜¶æ®µä¸‰ï¼ˆçŠ¶æ€ä¸è·¯ç”±æ‰©å±•ï¼‰å·²å®Œæˆ

---

## ğŸ¯ æœ¬é˜¶æ®µäº¤ä»˜ç‰©

### ä¿®æ”¹æ–‡ä»¶
1. `tradingagents/graph/setup.py` - æ·»åŠ æŒ‡æ•°åˆ†æå›¾æ„å»º
2. `tradingagents/agents/utils/agent_utils.py` - æ³¨å†Œindexå·¥å…·
3. åº”ç”¨å±‚å…¥å£ï¼ˆAPI/CLIï¼‰ - æ·»åŠ è·¯ç”±åˆ¤æ–­

### æµ‹è¯•æ–‡ä»¶
4. `tests/integration/test_index_analysis_workflow.py` - å·¥ä½œæµé›†æˆæµ‹è¯•
5. `tests/integration/test_stock_analysis_regression.py` - å›å½’æµ‹è¯•
6. `tests/integration/test_routing.py` - è·¯ç”±åˆ¤æ–­æµ‹è¯•

---

## ğŸ“ è¯¦ç»†å¼€å‘ä»»åŠ¡

### ä»»åŠ¡4.1ï¼šæ‰©å±•GraphSetup

**æ–‡ä»¶**ï¼š`tradingagents/graph/setup.py`

**ä¿®æ”¹ç›®æ ‡**ï¼š
- âœ… æ·»åŠ  `analysis_type` å‚æ•°
- âœ… å®ç° `_setup_index_graph()` æ–¹æ³•
- âœ… ä¿æŒç°æœ‰ `setup_graph()` åŠŸèƒ½ä¸å˜

**ä¿®æ”¹æ¸…å•**ï¼š

#### 1. ä¿®æ”¹ `setup_graph()` æ–¹æ³•ç­¾å
```python
def setup_graph(
    self, 
    selected_analysts=["market", "social", "news", "fundamentals"],
    analysis_type="stock"  # æ–°å¢å‚æ•°ï¼š"stock" æˆ– "index"
):
    """
    Set up and compile the agent workflow graph.

    Args:
        selected_analysts (list): List of analyst types to include (for stock analysis).
        analysis_type (str): "stock" for individual stock analysis, "index" for index analysis.
    """
    
    if analysis_type == "stock":
        return self._setup_stock_graph(selected_analysts)
    elif analysis_type == "index":
        return self._setup_index_graph()
    else:
        raise ValueError(f"Unknown analysis_type: {analysis_type}")
```

#### 2. é‡æ„ç°æœ‰é€»è¾‘åˆ° `_setup_stock_graph()`
```python
def _setup_stock_graph(self, selected_analysts):
    """
    ç°æœ‰çš„ä¸ªè‚¡åˆ†æå›¾æ„å»ºé€»è¾‘ï¼ˆä¿æŒä¸å˜ï¼‰
    """
    # å°†ç°æœ‰ setup_graph() çš„å…¨éƒ¨ä»£ç ç§»åˆ°è¿™é‡Œ
    # ä¸åšä»»ä½•åŠŸèƒ½ä¿®æ”¹ï¼Œåªæ˜¯é‡æ„
    pass
```

#### 3. å®ç° `_setup_index_graph()` æ–¹æ³•
```python
def _setup_index_graph(self):
    """
    æ–°å¢ï¼šæŒ‡æ•°åˆ†æå›¾æ„å»ºé€»è¾‘
    
    æŒ‡æ•°åˆ†ææµç¨‹ï¼š
    START â†’ Macro Analyst â†’ Policy Analyst â†’ Sector Analyst â†’ Strategy Advisor â†’ END
    """
    from tradingagents.agents.analysts.macro_analyst import create_macro_analyst
    from tradingagents.agents.analysts.policy_analyst import create_policy_analyst
    from tradingagents.agents.analysts.sector_analyst import create_sector_analyst
    from tradingagents.agents.analysts.strategy_advisor import create_strategy_advisor
    from tradingagents.agents.utils.agent_utils import create_msg_delete
    from langgraph.graph import StateGraph, START, END
    
    logger.info("ğŸ—ï¸ [å›¾æ„å»º] å¼€å§‹æ„å»ºæŒ‡æ•°åˆ†æå·¥ä½œæµ")
    
    # 1. åˆ›å»ºåˆ†æå¸ˆèŠ‚ç‚¹
    index_toolkit = self.toolkit
    macro_analyst_node = create_macro_analyst(self.quick_thinking_llm, index_toolkit)
    policy_analyst_node = create_policy_analyst(self.quick_thinking_llm, index_toolkit)
    sector_analyst_node = create_sector_analyst(self.quick_thinking_llm, index_toolkit)
    strategy_advisor_node = create_strategy_advisor(self.deep_thinking_llm)
    
    # 2. åˆ›å»ºæ¶ˆæ¯æ¸…ç†èŠ‚ç‚¹
    macro_clear = create_msg_delete()
    policy_clear = create_msg_delete()
    sector_clear = create_msg_delete()
    strategy_clear = create_msg_delete()
    
    # 3. åˆ›å»ºå·¥ä½œæµ
    workflow = StateGraph(AgentState)
    
    # 4. æ·»åŠ èŠ‚ç‚¹
    workflow.add_node("Macro Analyst", macro_analyst_node)
    workflow.add_node("Msg Clear Macro", macro_clear)
    workflow.add_node("tools_macro", self.tool_nodes.get("index_macro"))
    
    workflow.add_node("Policy Analyst", policy_analyst_node)
    workflow.add_node("Msg Clear Policy", policy_clear)
    workflow.add_node("tools_policy", self.tool_nodes.get("index_policy"))
    
    workflow.add_node("Sector Analyst", sector_analyst_node)
    workflow.add_node("Msg Clear Sector", sector_clear)
    workflow.add_node("tools_sector", self.tool_nodes.get("index_sector"))
    
    workflow.add_node("Strategy Advisor", strategy_advisor_node)
    workflow.add_node("Msg Clear Strategy", strategy_clear)
    
    # 5. å®šä¹‰è¾¹
    # START â†’ Macro Analyst
    workflow.add_edge(START, "Macro Analyst")
    
    # Macro Analyst â†” tools_macro
    workflow.add_conditional_edges(
        "Macro Analyst",
        self.conditional_logic.should_continue_macro,
        ["tools_macro", "Msg Clear Macro"],
    )
    workflow.add_edge("tools_macro", "Macro Analyst")
    workflow.add_edge("Msg Clear Macro", "Policy Analyst")
    
    # Policy Analyst â†” tools_policy
    workflow.add_conditional_edges(
        "Policy Analyst",
        self.conditional_logic.should_continue_policy,
        ["tools_policy", "Msg Clear Policy"],
    )
    workflow.add_edge("tools_policy", "Policy Analyst")
    workflow.add_edge("Msg Clear Policy", "Sector Analyst")
    
    # Sector Analyst â†” tools_sector
    workflow.add_conditional_edges(
        "Sector Analyst",
        self.conditional_logic.should_continue_sector,
        ["tools_sector", "Msg Clear Sector"],
    )
    workflow.add_edge("tools_sector", "Sector Analyst")
    workflow.add_edge("Msg Clear Sector", "Strategy Advisor")
    
    # Strategy Advisor â†’ END
    workflow.add_conditional_edges(
        "Strategy Advisor",
        self.conditional_logic.should_continue_strategy,
        ["Msg Clear Strategy"],
    )
    workflow.add_edge("Msg Clear Strategy", END)
    
    # 6. ç¼–è¯‘å›¾
    graph = workflow.compile()
    logger.info("âœ… [å›¾æ„å»º] æŒ‡æ•°åˆ†æå·¥ä½œæµæ„å»ºå®Œæˆ")
    
    return graph
```

**å‚è€ƒä»£ç ä½ç½®**ï¼šè¯¦ç»†è®¾è®¡æ–‡æ¡£ ç¬¬4.2èŠ‚

**éªŒè¯è¦ç‚¹**ï¼š
- âœ… å›¾ç»“æ„æ­£ç¡®ï¼ˆå¯ä»¥é€šè¿‡ `graph.get_graph().nodes()` æŸ¥çœ‹ï¼‰
- âœ… è¾¹è¿æ¥æ­£ç¡®ï¼ˆSTART â†’ ... â†’ ENDï¼‰
- âœ… æ¡ä»¶è¾¹è¿”å›å€¼åŒ¹é…èŠ‚ç‚¹åç§°
- âœ… æ—¥å¿—è¾“å‡ºæ¸…æ™°

---

### ä»»åŠ¡4.2ï¼šå·¥å…·é›†æ³¨å†Œ

**æ–‡ä»¶**ï¼š`tradingagents/agents/utils/agent_utils.py`

**ä¿®æ”¹ç›®æ ‡**ï¼š
- âœ… åœ¨ `Toolkit` ç±»ä¸­æ³¨å†Œindexåˆ†æå·¥å…·
- âœ… åœ¨ `__init__()` æ–¹æ³•ä¸­åˆå§‹åŒ–å·¥å…·

**ä¿®æ”¹ç¤ºä¾‹**ï¼š
```python
class Toolkit:
    def __init__(self):
        # ... ç°æœ‰å·¥å…·åˆå§‹åŒ– ...
        
        # ğŸ†• æ–°å¢ï¼šæŒ‡æ•°åˆ†æå·¥å…·
        try:
            from tradingagents.tools.index_tools import (
                fetch_macro_data,
                fetch_policy_news,
                fetch_sector_rotation
            )
            self.fetch_macro_data = fetch_macro_data
            self.fetch_policy_news = fetch_policy_news
            self.fetch_sector_rotation = fetch_sector_rotation
            logger.info("âœ… æŒ‡æ•°åˆ†æå·¥å…·æ³¨å†ŒæˆåŠŸ")
        except ImportError as e:
            logger.warning(f"âš ï¸ æŒ‡æ•°åˆ†æå·¥å…·å¯¼å…¥å¤±è´¥: {e}")
            self.fetch_macro_data = None
            self.fetch_policy_news = None
            self.fetch_sector_rotation = None
```

**å·¥å…·èŠ‚ç‚¹åˆå§‹åŒ–**ï¼ˆåœ¨GraphSetupä¸­æˆ–å¤–éƒ¨ï¼‰ï¼š
```python
# åœ¨åˆ›å»ºGraphSetupå®ä¾‹æ—¶ï¼Œç¡®ä¿tool_nodesåŒ…å«indexå·¥å…·èŠ‚ç‚¹
from langgraph.prebuilt import ToolNode

tool_nodes = {
    # ç°æœ‰å·¥å…·èŠ‚ç‚¹
    "market": ToolNode([toolkit.get_stock_market_data_unified]),
    "news": ToolNode([toolkit.get_news_data]),
    # ... å…¶ä»–ç°æœ‰å·¥å…·èŠ‚ç‚¹ ...
    
    # æ–°å¢ï¼šæŒ‡æ•°åˆ†æå·¥å…·èŠ‚ç‚¹
    "index_macro": ToolNode([toolkit.fetch_macro_data]),
    "index_policy": ToolNode([toolkit.fetch_policy_news]),
    "index_sector": ToolNode([toolkit.fetch_sector_rotation]),
}
```

**éªŒè¯è¦ç‚¹**ï¼š
- âœ… å·¥å…·å¯ä»¥è¢«Toolkitæ­£ç¡®åŠ è½½
- âœ… å·¥å…·èŠ‚ç‚¹å¯ä»¥è¢«GraphSetupè®¿é—®
- âœ… å¯¼å…¥å¤±è´¥æ—¶æœ‰å‹å¥½çš„é”™è¯¯æç¤º

---

### ä»»åŠ¡4.3ï¼šåº”ç”¨å±‚è·¯ç”±é›†æˆ

**æ–‡ä»¶**ï¼šåº”ç”¨å±‚å…¥å£ï¼ˆå¦‚ `main.py`ã€`api.py` æˆ– CLIï¼‰

**ä¿®æ”¹ç›®æ ‡**ï¼š
- âœ… å®ç° `_is_index_ticker()` åˆ¤æ–­å‡½æ•°
- âœ… åœ¨ `analyze()` å‡½æ•°ä¸­æ·»åŠ è·¯ç”±é€»è¾‘
- âœ… æ ¹æ® `is_index` é€‰æ‹©å¯¹åº”çš„å·¥ä½œæµ

**å®ç°ç¤ºä¾‹**ï¼š

#### 1. åˆ¤æ–­å‡½æ•°å®ç°
```python
def _is_index_ticker(ticker: str) -> bool:
    """
    åˆ¤æ–­æ˜¯å¦ä¸ºæŒ‡æ•°ä»£ç 
    
    å¸¸è§æŒ‡æ•°ä»£ç è§„åˆ™ï¼š
    - ä¸Šè¯æŒ‡æ•°: sh000001, 000001.SH
    - æ·±è¯æˆæŒ‡: sz399001, 399001.SZ
    - åˆ›ä¸šæ¿æŒ‡: sz399006, 399006.SZ
    - ç§‘åˆ›50: sh000688, 000688.SH
    
    Args:
        ticker: è‚¡ç¥¨/æŒ‡æ•°ä»£ç 
        
    Returns:
        bool: Trueä¸ºæŒ‡æ•°ï¼ŒFalseä¸ºä¸ªè‚¡
    """
    # æ¸…ç†ä»£ç 
    ticker_clean = ticker.upper().replace('.SH', '').replace('.SZ', '')
    ticker_clean = ticker_clean.replace('SH', '').replace('SZ', '')
    
    # è§„åˆ™1ï¼šä»¥ 000ã€399 å¼€å¤´çš„æ˜¯æŒ‡æ•°
    index_prefixes = ['000', '399']
    for prefix in index_prefixes:
        if ticker_clean.startswith(prefix):
            return True
    
    # è§„åˆ™2ï¼šç™½åå•ï¼ˆå¯é…ç½®ï¼‰
    index_whitelist = [
        'sh000001', '000001.SH',  # ä¸Šè¯æŒ‡æ•°
        'sz399001', '399001.SZ',  # æ·±è¯æˆæŒ‡
        'sz399006', '399006.SZ',  # åˆ›ä¸šæ¿æŒ‡
        'sh000688', '000688.SH',  # ç§‘åˆ›50
        'sh000300', '000300.SH',  # æ²ªæ·±300
        'sh000016', '000016.SH',  # ä¸Šè¯50
        'sz399905', '399905.SZ',  # ä¸­è¯500
    ]
    
    return ticker.lower() in [x.lower() for x in index_whitelist]
```

#### 2. è·¯ç”±é€»è¾‘å®ç°
```python
def analyze(ticker: str, trade_date: str, llm_config: dict):
    """
    åˆ†æè‚¡ç¥¨æˆ–æŒ‡æ•°
    
    Args:
        ticker: è‚¡ç¥¨ä»£ç æˆ–æŒ‡æ•°ä»£ç 
        trade_date: äº¤æ˜“æ—¥æœŸ
        llm_config: LLMé…ç½®
        
    Returns:
        åˆ†æç»“æœ
    """
    # 1. åˆ¤æ–­æ˜¯å¦ä¸ºæŒ‡æ•°
    is_index = _is_index_ticker(ticker)
    
    if is_index:
        logger.info(f"ğŸ“Š æ£€æµ‹åˆ°æŒ‡æ•°ä»£ç : {ticker}ï¼Œå¯åŠ¨æŒ‡æ•°åˆ†ææµç¨‹")
    else:
        logger.info(f"ğŸ“ˆ æ£€æµ‹åˆ°ä¸ªè‚¡ä»£ç : {ticker}ï¼Œå¯åŠ¨ä¸ªè‚¡åˆ†ææµç¨‹")
    
    # 2. åˆå§‹åŒ–çŠ¶æ€
    initial_state = {
        "company_of_interest": ticker,
        "trade_date": trade_date,
        "messages": [],
        "is_index": is_index,
    }
    
    # æ ¹æ®åˆ†æç±»å‹æ·»åŠ ç‰¹å®šå­—æ®µ
    if is_index:
        initial_state.update({
            "macro_report": "",
            "policy_report": "",
            "sector_report": "",
            "strategy_report": "",
            "macro_tool_call_count": 0,
            "policy_tool_call_count": 0,
            "sector_tool_call_count": 0,
        })
    else:
        initial_state.update({
            "market_report": "",
            "news_report": "",
            "sentiment_report": "",
            "fundamentals_report": "",
            "market_tool_call_count": 0,
            "news_tool_call_count": 0,
            "sentiment_tool_call_count": 0,
            "fundamentals_tool_call_count": 0,
        })
    
    # 3. æ„å»ºå›¾
    graph_setup = GraphSetup(
        quick_thinking_llm=llm_config['quick_llm'],
        deep_thinking_llm=llm_config['deep_llm'],
        toolkit=toolkit,
        tool_nodes=tool_nodes,
        # ... å…¶ä»–å‚æ•° ...
    )
    
    # 4. æ ¹æ®ç±»å‹é€‰æ‹©å·¥ä½œæµ
    if is_index:
        graph = graph_setup.setup_graph(analysis_type="index")
    else:
        graph = graph_setup.setup_graph(
            selected_analysts=["market", "social", "news", "fundamentals"],
            analysis_type="stock"
        )
    
    # 5. æ‰§è¡Œå›¾
    logger.info(f"ğŸš€ å¼€å§‹æ‰§è¡Œ{('æŒ‡æ•°' if is_index else 'ä¸ªè‚¡')}åˆ†æå·¥ä½œæµ")
    result = graph.invoke(initial_state)
    logger.info(f"âœ… å·¥ä½œæµæ‰§è¡Œå®Œæˆ")
    
    return result
```

**å‚è€ƒä»£ç ä½ç½®**ï¼šè¯¦ç»†è®¾è®¡æ–‡æ¡£ ç¬¬4.3èŠ‚

**éªŒè¯è¦ç‚¹**ï¼š
- âœ… æŒ‡æ•°ä»£ç è¯†åˆ«å‡†ç¡®
- âœ… ä¸ªè‚¡ä»£ç ä¸è¢«è¯¯åˆ¤
- âœ… çŠ¶æ€åˆå§‹åŒ–æ­£ç¡®
- âœ… å·¥ä½œæµé€‰æ‹©æ­£ç¡®

---

### ä»»åŠ¡4.4ï¼šç¼–å†™é›†æˆæµ‹è¯•

**æµ‹è¯•æ–‡ä»¶**ï¼š
- `tests/integration/test_index_analysis_workflow.py`
- `tests/integration/test_stock_analysis_regression.py`
- `tests/integration/test_routing.py`

#### test_index_analysis_workflow.py
```python
import pytest
from tradingagents.graph.setup import GraphSetup
from tradingagents.graph.conditional_logic import ConditionalLogic
from tradingagents.agents.utils.agent_utils import Toolkit
from langchain_openai import ChatOpenAI
from langgraph.prebuilt import ToolNode

@pytest.fixture
def graph_setup():
    """åˆå§‹åŒ–GraphSetup"""
    quick_llm = ChatOpenAI(model="gpt-4o-mini", temperature=0)
    deep_llm = ChatOpenAI(model="gpt-4o", temperature=0)
    toolkit = Toolkit()
    
    tool_nodes = {
        "index_macro": ToolNode([toolkit.fetch_macro_data]),
        "index_policy": ToolNode([toolkit.fetch_policy_news]),
        "index_sector": ToolNode([toolkit.fetch_sector_rotation]),
    }
    
    conditional_logic = ConditionalLogic()
    
    return GraphSetup(
        quick_thinking_llm=quick_llm,
        deep_thinking_llm=deep_llm,
        toolkit=toolkit,
        tool_nodes=tool_nodes,
        bull_memory=None,
        bear_memory=None,
        trader_memory=None,
        invest_judge_memory=None,
        risk_manager_memory=None,
        conditional_logic=conditional_logic,
    )

def test_index_analysis_workflow_structure(graph_setup):
    """æµ‹è¯•æŒ‡æ•°åˆ†æå·¥ä½œæµç»“æ„"""
    graph = graph_setup.setup_graph(analysis_type="index")
    
    # éªŒè¯èŠ‚ç‚¹å­˜åœ¨
    nodes = graph.get_graph().nodes()
    assert "Macro Analyst" in str(nodes)
    assert "Policy Analyst" in str(nodes)
    assert "Sector Analyst" in str(nodes)
    assert "Strategy Advisor" in str(nodes)

def test_index_analysis_workflow_execution(graph_setup):
    """æµ‹è¯•å®Œæ•´çš„æŒ‡æ•°åˆ†æå·¥ä½œæµæ‰§è¡Œ"""
    graph = graph_setup.setup_graph(analysis_type="index")
    
    initial_state = {
        "company_of_interest": "sh000001",
        "trade_date": "2024-12-10",
        "is_index": True,
        "messages": [],
        "macro_report": "",
        "policy_report": "",
        "sector_report": "",
        "strategy_report": "",
        "macro_tool_call_count": 0,
        "policy_tool_call_count": 0,
        "sector_tool_call_count": 0,
    }
    
    # æ‰§è¡Œå·¥ä½œæµ
    result = graph.invoke(initial_state)
    
    # éªŒè¯æ‰€æœ‰æŠ¥å‘Šéƒ½ç”Ÿæˆäº†
    assert len(result.get("macro_report", "")) > 0
    assert len(result.get("policy_report", "")) > 0
    assert len(result.get("sector_report", "")) > 0
    assert len(result.get("strategy_report", "")) > 0
    
    # éªŒè¯æŠ¥å‘Šæ ¼å¼
    import json
    try:
        macro_data = json.loads(result["macro_report"])
        assert "confidence" in macro_data
        assert "sentiment_score" in macro_data
    except:
        pass  # å¦‚æœJSONè§£æå¤±è´¥ï¼Œä¸å¼ºåˆ¶è¦æ±‚
```

#### test_stock_analysis_regression.py
```python
def test_stock_analysis_still_works(graph_setup):
    """å›å½’æµ‹è¯•ï¼šç¡®ä¿ä¸ªè‚¡åˆ†ææµç¨‹ä»ç„¶æ­£å¸¸å·¥ä½œ"""
    graph = graph_setup.setup_graph(
        selected_analysts=["market", "news"],
        analysis_type="stock"
    )
    
    initial_state = {
        "company_of_interest": "600519",
        "trade_date": "2024-12-10",
        "is_index": False,
        "messages": [],
        "market_report": "",
        "news_report": "",
        "market_tool_call_count": 0,
        "news_tool_call_count": 0,
    }
    
    result = graph.invoke(initial_state)
    
    # éªŒè¯ä¸ªè‚¡æŠ¥å‘Šç”Ÿæˆ
    assert "market_report" in result
    assert "news_report" in result
    
    # ç¡®ä¿æ²¡æœ‰æ„å¤–è®¿é—®æŒ‡æ•°å­—æ®µ
    assert result.get("macro_report", "") == ""
    assert result.get("policy_report", "") == ""
```

#### test_routing.py
```python
def test_is_index_ticker():
    """æµ‹è¯•æŒ‡æ•°ä»£ç è¯†åˆ«"""
    from your_module import _is_index_ticker
    
    # æŒ‡æ•°ä»£ç 
    assert _is_index_ticker("sh000001") == True
    assert _is_index_ticker("000001.SH") == True
    assert _is_index_ticker("sz399001") == True
    assert _is_index_ticker("399006.SZ") == True
    
    # ä¸ªè‚¡ä»£ç 
    assert _is_index_ticker("600519") == False
    assert _is_index_ticker("000001") == False  # æ·±å‘å±•Aï¼ˆä¸ªè‚¡ï¼‰
    assert _is_index_ticker("300750") == False
```

---

## ğŸ”„ å¼€å‘æµç¨‹

### Day 1: GraphSetupæ‰©å±•
1. **ä¸Šåˆ**
   - å¤‡ä»½ `setup.py`
   - é‡æ„ç°æœ‰ä»£ç åˆ° `_setup_stock_graph()`
   - ä¿®æ”¹ `setup_graph()` æ–¹æ³•ç­¾å
   
2. **ä¸‹åˆ**
   - å®ç° `_setup_index_graph()` æ–¹æ³•
   - æ·»åŠ èŠ‚ç‚¹å’Œè¾¹
   - æµ‹è¯•å›¾ç»“æ„

3. **éªŒæ”¶**
   - å›¾ç»“æ„æ­£ç¡®
   - ç°æœ‰ä¸ªè‚¡æµç¨‹ä¸å—å½±å“

### Day 2: å·¥å…·æ³¨å†Œå’Œè·¯ç”±é›†æˆ
1. **ä¸Šåˆ**
   - åœ¨ `agent_utils.py` ä¸­æ³¨å†Œindexå·¥å…·
   - åˆå§‹åŒ–å·¥å…·èŠ‚ç‚¹
   - æµ‹è¯•å·¥å…·åŠ è½½
   
2. **ä¸‹åˆ**
   - å®ç° `_is_index_ticker()` å‡½æ•°
   - å®ç°è·¯ç”±é€»è¾‘
   - ç¼–å†™è·¯ç”±æµ‹è¯•

3. **éªŒæ”¶**
   - å·¥å…·æ³¨å†ŒæˆåŠŸ
   - è·¯ç”±åˆ¤æ–­å‡†ç¡®

### Day 3: é›†æˆæµ‹è¯•å’Œä¼˜åŒ–
1. **ä¸Šåˆ**
   - ç¼–å†™é›†æˆæµ‹è¯•
   - è¿è¡Œå®Œæ•´å·¥ä½œæµ
   - ä¿®å¤bug
   
2. **ä¸‹åˆ**
   - è¿è¡Œå›å½’æµ‹è¯•
   - æ€§èƒ½æµ‹è¯•
   - Code Review

3. **éªŒæ”¶**
   - æ‰€æœ‰æµ‹è¯•é€šè¿‡
   - æ€§èƒ½ç¬¦åˆé¢„æœŸ

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] æŒ‡æ•°åˆ†æå·¥ä½œæµå¯ä»¥å®Œæ•´è¿è¡Œ
- [ ] ä¸ªè‚¡åˆ†æå·¥ä½œæµä¸å—å½±å“
- [ ] è·¯ç”±åˆ¤æ–­å‡†ç¡®ï¼ˆæŒ‡æ•°/ä¸ªè‚¡ï¼‰
- [ ] æ‰€æœ‰AgentèŠ‚ç‚¹æŒ‰é¡ºåºæ‰§è¡Œ
- [ ] æŠ¥å‘Šåœ¨èŠ‚ç‚¹é—´æ­£ç¡®ä¼ é€’

### è´¨é‡éªŒæ”¶
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] å›å½’æµ‹è¯•é€šè¿‡ï¼ˆç°æœ‰åŠŸèƒ½æ­£å¸¸ï¼‰
- [ ] è·¯ç”±æµ‹è¯•é€šè¿‡
- [ ] æ—¥å¿—è¾“å‡ºæ¸…æ™°
- [ ] æ— pylint/flake8è­¦å‘Š

### æ€§èƒ½éªŒæ”¶
- [ ] æŒ‡æ•°åˆ†ææ‰§è¡Œæ—¶é—´ < 2åˆ†é’Ÿ
- [ ] ä¸ªè‚¡åˆ†ææ‰§è¡Œæ—¶é—´ä¸ä¹‹å‰ä¸€è‡´
- [ ] å·¥å…·è°ƒç”¨æ¬¡æ•°åˆç†ï¼ˆâ‰¤ 3æ¬¡/Agentï¼‰

---

## ğŸ“Š è¿›åº¦è·Ÿè¸ª

| ä»»åŠ¡ | è´Ÿè´£äºº | å¼€å§‹æ—¶é—´ | é¢„è®¡å®Œæˆ | å®é™…å®Œæˆ | çŠ¶æ€ |
|------|--------|----------|----------|----------|------|
| ä»»åŠ¡4.1 æ‰©å±•GraphSetup | - | - | Day 1 | - | ğŸ“‹ å¾…å¼€å§‹ |
| ä»»åŠ¡4.2 å·¥å…·é›†æ³¨å†Œ | - | - | Day 2 ä¸Šåˆ | - | ğŸ“‹ å¾…å¼€å§‹ |
| ä»»åŠ¡4.3 è·¯ç”±é›†æˆ | - | - | Day 2 ä¸‹åˆ | - | ğŸ“‹ å¾…å¼€å§‹ |
| ä»»åŠ¡4.4 é›†æˆæµ‹è¯• | - | - | Day 3 | - | ğŸ“‹ å¾…å¼€å§‹ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å›¾æ„å»ºè¦ç‚¹
1. **èŠ‚ç‚¹å‘½åä¸€è‡´æ€§** - ç¡®ä¿èŠ‚ç‚¹åç§°ä¸æ¡ä»¶è¾¹è¿”å›å€¼å®Œå…¨åŒ¹é…
2. **å·¥å…·èŠ‚ç‚¹å­˜åœ¨æ€§** - ç¡®ä¿ `self.tool_nodes.get()` èƒ½æ­£ç¡®è·å–
3. **çŠ¶æ€ç±»å‹æ­£ç¡®** - workflowä½¿ç”¨çš„æ˜¯AgentState

### è·¯ç”±åˆ¤æ–­
1. **ç™½åå•ç»´æŠ¤** - å®šæœŸæ›´æ–°æŒ‡æ•°ç™½åå•
2. **è¾¹ç•Œæƒ…å†µ** - å¤„ç†ä»£ç æ ¼å¼ä¸æ ‡å‡†çš„æƒ…å†µ
3. **ç”¨æˆ·ç¡®è®¤** - å¯é€‰ï¼šè®©ç”¨æˆ·ç¡®è®¤æ˜¯å¦ä¸ºæŒ‡æ•°

### æµ‹è¯•é‡ç‚¹
1. **ç«¯åˆ°ç«¯æµ‹è¯•** - ä»analyze()å‡½æ•°å¼€å§‹ï¼Œå®Œæ•´æ‰§è¡Œ
2. **è¾¹ç•Œæµ‹è¯•** - æµ‹è¯•å„ç§ä»£ç æ ¼å¼
3. **æ€§èƒ½æµ‹è¯•** - ç¡®ä¿æ‰§è¡Œæ—¶é—´åˆç†

---

## ğŸ”— ç›¸å…³èµ„æº

- **å‚è€ƒå®ç°**ï¼š
  - `tradingagents/graph/setup.py` - ç°æœ‰å›¾æ„å»º
  - LangGraphç¤ºä¾‹ï¼šhttps://langchain-ai.github.io/langgraph/tutorials/
- **å›¾å¯è§†åŒ–**ï¼šå¯ä»¥ä½¿ç”¨ `graph.get_graph().draw_mermaid()` ç”ŸæˆMermaidå›¾

---

**ä¸Šä¸€é˜¶æ®µ**ï¼š[é˜¶æ®µä¸‰-çŠ¶æ€ä¸è·¯ç”±æ‰©å±•](./é˜¶æ®µä¸‰-çŠ¶æ€ä¸è·¯ç”±æ‰©å±•.md)  
**ä¸‹ä¸€é˜¶æ®µ**ï¼š[é˜¶æ®µäº”-æµ‹è¯•ä¸ä¼˜åŒ–](./é˜¶æ®µäº”-æµ‹è¯•ä¸ä¼˜åŒ–.md)

---

**ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2024-12-11  
**æœ€åæ›´æ–°**: 2024-12-11
