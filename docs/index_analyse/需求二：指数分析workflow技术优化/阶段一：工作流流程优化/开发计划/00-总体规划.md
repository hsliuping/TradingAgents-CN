# 指数分析 Workflow 流程优化 - 总体开发规划

## 1. 概览

**版本目标**: v2.6.0
**时间周期**: 2026-01-01 至 2026-02-15 (预估)
**核心任务**: 优化指数分析 Workflow 的性能（缓存）、灵活性（动态Agent）、深度（参数强化）及职能划分（政策/新闻分离）。

## 2. 任务分解

### 阶段一：性能与基础架构 (Week 1)
*   [ ] **宏观分析缓存**: 实现 MongoDB 缓存机制。
*   [ ] **动态 Agent 选择**: 改造后端 Graph 构建逻辑，支持 `selected_analysts` 透传。
*   [ ] **服务层修复**: 移除强制重置逻辑。

### 阶段二：职能重构与 Prompt 优化 (Week 2)
*   [ ] **政策与新闻分离**: 拆分 `Policy Analyst` 和 `News Analyst`，重写 Prompt 和工具绑定。
*   [ ] **Prompt 深度强化**: 更新 `Strategy Advisor` 和 `Risk Manager` 的 Prompt，注入基于 `research_depth` 的指令。

### 阶段三：多空与风控增强 (Week 3)
*   [ ] **多空博弈**: 实现历史模式匹配逻辑（需数据支持，可先实现框架）。
*   [ ] **风险管理**: 调整指数模式下的风险关注点（宏观/系统性）。

### 阶段四：新节点预研与集成 (Week 4-6)
*   [ ] **情绪分析**: 调研社交媒体数据源，设计 `Sentiment Analyst` 原型。
*   [ ] **测试与验收**: 编写单元测试和集成测试，验证所有新特性。

## 3. 进度追踪

| 任务模块 | 负责人 | 状态 | 进度 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **宏观缓存** | @zhengweicheng | ✅ 已完成 | 100% | 已合并代码，测试通过 |
| **动态Agent选择** | TBD | ✅ 已完成 | 100% | Graph构建逻辑已完成，支持selected_analysts参数 |
| **政策/新闻重构** | TBD | ✅ 已完成 | 100% | Agent重构完成，职能分离已实现 |
| **全球情报分析师** | TBD | ✅ 已完成 | 100% | 已升级为News Analyst，集成多源新闻工具 |
| **风控深度改造** | TBD | ✅ 已完成 | 100% | Prompt已更新，逻辑分流已实现 |
| **情绪分析师** | TBD | 📅 规划中 | 0% | 已移至待规划需求，v2.7.0考虑实现 |
| **辅助数据源探测** | TBD | 📅 待开始 | 0% | 计划在v2.7.0实现 |

## 4. 风险管理

*   **数据源稳定性**: 部分新数据源（如 Twitter）可能不稳定，需提前设计降级方案。
*   **Prompt 调优**: 大模型对指令的遵循程度可能有波动，需预留充足的测试调优时间。