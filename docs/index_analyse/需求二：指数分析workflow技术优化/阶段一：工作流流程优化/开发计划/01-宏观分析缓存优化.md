# 开发计划 01 - 宏观分析 Agent 缓存优化

## 1. 任务目标
为 `Macro Analyst` 引入基于 MongoDB 的缓存机制，减少重复 API 调用，降低成本并提升响应速度。

## 2. 详细设计
*   **缓存键**: `macro_analysis:{trade_date}`
*   **TTL**: 7 天
*   **存储**: MongoDB `macro_analysis_cache` 集合

## 3. 开发步骤
1.  [x] 修改 `tradingagents/tools/index_tools.py`，引入数据库连接。
2.  [x] 实现缓存查询逻辑（Key 生成、过期判断）。
3.  [x] 实现缓存写入逻辑。
4.  [x] 编写单元测试 `tests/test_macro_cache.py`。

## 4. 验收标准
*   首次运行：API 被调用，结果写入数据库，日志显示“Cache Miss”。
*   二次运行（7天内）：API 未被调用，直接返回数据库结果，日志显示“Cache Hit”。
*   数据库故障：API 正常调用，无报错，日志显示“Cache Error, Fallback”。

## 5. 当前进度 (2026-01-01)
*   **状态**: ✅ 已完成
*   **说明**: 代码已合并，测试通过。