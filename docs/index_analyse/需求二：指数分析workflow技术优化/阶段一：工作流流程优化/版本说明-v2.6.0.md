# 版本说明 v2.6.0 - 指数分析 Workflow 流程优化

## 1. 版本概述

**版本号**: v2.6.0
**发布日期**: 2026-01-01
**主要目标**: 
本版本重点针对指数分析 Workflow 的流程效率、分析深度、系统健壮性以及功能节点进行了全面的技术优化。核心改进包括引入宏观分析缓存、重构政策与新闻分析职能、深化多空博弈与风险管理机制，以及新增情绪分析等节点，旨在打造一个更智能、更高效、更具韧性的投资分析系统。

## 2. 新增特性 (Features)

### 2.1 性能与效率提升
*   **[F-01] 宏观分析缓存机制**: 为 `Macro Analyst` 引入基于 MongoDB 的结果缓存（TTL=7天），显著减少重复 API 调用，降低 Token 消耗并缩短响应时间。
*   **[F-02] 动态 Agent 选择**: 支持通过接口透传 `selected_analysts` 参数，允许用户按需动态选择参与分析的模块（如仅运行宏观和政策分析），提升灵活性。
*   **[F-02-1] 全球情报分析师完成**: 原 `International News Analyst` 已升级为 `News Analyst`，集成了多源新闻工具（Bloomberg、Reuters、Google News、政策新闻），实现了国内外新闻的统一处理。

### 2.2 职能重构与深度优化
*   **[F-03] 政策与新闻职能分离**: 
    *   将 `Policy Analyst` 升级为 `Strategic Policy Analyst`，专注于长期、官方政策文本的深度解读。
    *   将 `International News Analyst` 升级为 `News Analyst`，统一处理所有短期、即时性的国内外新闻、事件及传闻。
*   **[F-04] 研究深度参数强化**: `research_depth` 参数现在全面影响 `Strategy Advisor` 的策略生成维度（跨周期对比、极端情境推演）和风险管理层的分析深度。

### 2.3 决策与风控增强
*   **[F-05] 风险管理层深度改造**: 
    *   `Risk Manager` 在指数模式下转变为“宏观风险管理委员会”，聚焦系统性风险、流动性危机。
    *   辩论专家（Risky/Safe/Neutral）针对指数分析场景进行了 Prompt 优化，强化对政策红利、通胀粘性等宏观因素的辩论。
*   **[F-06] 多空博弈机制优化**: 引入历史模式匹配，强制要求辩论双方引用历史相似案例作为论据，提升辩论质量。

### 2.4 新增分析节点（规划中）
*   **[F-07] 情绪分析师 (Sentiment Analyst)**: 计划引入该节点，监控社交媒体情绪，构建恐慌/贪婪指数。**详细规划已移至 [`待规划需求/情绪分析agent.md`](../../../待规划需求/情绪分析agent.md)，v2.7.0版本考虑实现**。
*   **[F-08] 全球情报分析师 (Global Intelligence Analyst)**: ✅ **已完成** - 原 `International News Analyst` 已升级为功能更全面的 `News Analyst`，实现了多源新闻聚合和智能分析。

## 3. 修复与改进 (Fixes & Improvements)

*   **[I-01] 服务层逻辑修复**: 修正了 `AnalysisService` 中针对指数分析任务强制重置分析师列表的逻辑。
*   **[I-02] 数据源健壮性**: 提出了在 `Index Info Collector` 后增加前置数据源健康检查的设计方案（高优先级待办）。
*   **[I-03] 代码结构优化**: 优化了 `graph/setup.py` 中的节点构建逻辑，支持更灵活的模块化组装。

## 4. 升级指南

### 4.1 配置变更
*   无需修改配置文件结构。
*   新增支持 `research_depth` 的更多选项：`['快速', '基础', '标准', '深度', '全面']`。

### 4.2 数据库变更
*   `system_configs` 集合中无需新增字段，但建议更新数据源配置以确保持续可用。
*   新增 `macro_analysis_cache` 相关集合（或复用现有集合并增加索引）用于存储宏观分析缓存。

## 5. 遗留问题与后续计划

*   **辅助数据源探测**: 目前尚未实现对 Google News、百度新闻等外部 API 的前置健康检查，计划在下一阶段（v2.7.0）重点解决。
*   **前端适配**: 前端界面暂未完全支持动态选择 Agent 和展示新的分析维度，需跟进开发。
*   **情绪分析师开发**: `Sentiment Analyst` 已完成详细规划，具体实施方案见 [`待规划需求/情绪分析agent.md`](../../../待规划需求/情绪分析agent.md)。