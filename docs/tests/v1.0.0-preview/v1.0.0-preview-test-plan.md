# TradingAgents-CN v1.0.0-preview 测试计划

## 1. 目标
- 从用户与系统两个视角，对 v1.0.0-preview 版本进行一次端到端功能回归
- 重点验证多智能体股票分析、数据同步、多市场支持、报告导出及学习中心等核心能力
- 在不做压测的前提下，验证系统稳定性与关键异常处理路径

## 2. 范围
- 后端：FastAPI 服务（app/），后台 worker（app/worker），MongoDB + Redis
- 前端：Vue 3 单页应用（frontend/）
- 辅助界面：如仍在使用，则对 Streamlit 界面（web/）做一次冒烟验证
- 不包含：真实资金交易与生产级性能/压测

## 3. 测试环境

### 3.1 安装模式
v1.0.0-preview 支持 4 种安装模式，建议至少测试其中 2 种：

| 安装模式 | 适用场景 | 测试优先级 | 说明 |
|---------|---------|-----------|------|
| 🟢 **绿色版** | Windows 用户、快速体验 | **P0** | 一键安装，适合快速验证 |
| 🐳 **Docker 版** | 生产环境、跨平台 | **P0** | 推荐用于正式部署测试 |
| 💻 **源码版** | 开发者、定制需求 | **P1** | 适合开发调试 |
| 🪟 **Windows 安装版** | Windows 原生安装 | **P2** | 如果提供安装包则测试 |

### 3.2 环境要求
- **绿色版**：Windows 10/11，无需额外安装
- **Docker 版**：Docker 20.10+，Docker Compose 2.0+
- **源码版**：Python 3.10+，Node.js 18+，MongoDB 5.0+，Redis 6.0+
- **LLM**：至少配置 1 个可用的主力模型（如阿里百炼 qwen / Google Gemini）
- **前端访问**：浏览器访问（默认 http://localhost:3000）
- **（可选）旧版 Streamlit**：按 web/README.md 启动后，访问 http://localhost:8501

## 4. 测试优先级与轮次
- P0 冒烟（先执行）  
  - 系统可启动（后端 + worker + 前端）
  - 完整跑通 1 次单只股票分析并查看报告
  - 学习中心可正常打开至少 1 篇文章（如 what-is-llm）
  - 至少 1 种报告导出方式可用（Markdown/PDF/Word 任一）
- P1 核心功能回归  
  - 多市场数据同步、股票详情页、自选股、筛选
  - 批量分析 / 任务中心、通知中心、操作日志
- P2 稳定性 & 异常场景  
  - 第三方数据源/LLM 不可用、网络异常、配置缺失等错误路径

## 5. 功能模块与主要用例

### 5.0 安装与部署测试（P0）

**测试目标**：验证不同安装模式的安装、启动、升级流程

#### 5.0.1 绿色版安装测试（P0）
- 下载绿色版压缩包并解压
- 运行 `start_all.bat` 启动所有服务
- 验证：
  - MongoDB、Redis、后端、前端服务全部启动成功
  - 浏览器自动打开 http://localhost:3000
  - 可以正常登录和使用
- 停止测试：运行 `stop_all.bat`，确认所有进程正常退出
- 升级测试：覆盖新版本文件，验证数据和配置保留

#### 5.0.2 Docker 版安装测试（P0）
- 使用 `docker-compose.yml` 或 `docker-compose.hub.yml` 部署
- 验证：
  - 所有容器正常启动（backend、frontend、mongodb、redis、nginx）
  - 访问配置的端口（默认 http://localhost）
  - 可以正常登录和使用
  - 数据持久化正常（重启容器后数据保留）
- 容器管理测试：stop、restart、logs、down 命令正常工作
- 升级测试：拉取新版本镜像，验证数据卷保留

#### 5.0.3 源码版安装测试（P1）
- 按照安装文档完成环境准备
- 安装后端依赖和前端依赖
- 启动后端和前端服务
- 验证：
  - 后端 API 可访问（http://localhost:8000/docs）
  - 前端页面可访问（http://localhost:3000）
  - 前后端联调正常
  - 热重载功能正常（开发模式）

#### 5.0.4 Windows 安装版测试（P2，如果有）
- 运行 Windows 安装程序
- 验证安装过程无错误
- 验证快捷方式和开始菜单项创建
- 验证服务自动启动
- 验证卸载程序正常工作

**参考文档**：
- 绿色版安装指南：https://mp.weixin.qq.com/s/eoo_HeIGxaQZVT76LBbRJQ
- Docker 部署指南：https://mp.weixin.qq.com/s/JkA0cOu8xJnoY_3LC5oXNw
- 源码安装指南：https://mp.weixin.qq.com/s/cqUGf-sAzcBV19gdI4sYfA
- 测试用例详情：`docs/tests/v1.0.0-preview/test-cases.md` 模块 0

### 5.1 系统启动与健康检查（P0）
- 确认系统已按上述任一方式成功安装和启动
- 验证：
  - 健康检查接口或“系统状态”页面显示正常
  - 首页（Dashboard）可访问，无严重前端/后端错误
  - 所有必需服务（FastAPI、worker、MongoDB、Redis）运行正常

### 5.2 用户与权限（P0）
- 登录 / 登出流程
- 不同角色（管理员/普通用户，如存在）菜单与权限差异
- 未登录访问受限页面时，出现登录跳转或清晰错误提示
- 敏感操作（配置修改、数据同步、分析任务）在操作日志中有记录

### 5.3 配置管理与 LLM 提供商（P0–P1）
- 查看与修改 LLM 提供商、模型、数据源配置，并验证：
  - 再次打开配置页面时，设置正确回显
  - 新发起的分析任务使用最新配置（从报告中“模型信息”验证）
- 删除或错误配置 API Key 时：
  - 启动分析/同步会失败但给出明确错误提示，不导致服务崩溃

### 5.4 数据同步与多市场支持（P0–P1）
- 对 A 股、港股、美股分别执行：
  - 初始数据同步（或重建）
  - 增量更新（在已有数据基础上二次同步）
- 同步完成后，在前端可按代码/名称查询到对应市场股票
- 数据源异常（如断网、错误 token）时，同步任务失败并有日志与 UI 提示

### 5.5 单只股票分析（核心路径，P0）
- 选择 1–3 只代表性股票（A 股 / 港股 / 美股），执行完整分析：
  - 配置分析日期、分析师组合、研究深度
  - 观察进度指示（SSE/WebSocket）从排队 → 运行中 → 完成
  - 报告页面所有主要模块（技术、基本面、新闻、风险、结论等）有内容，无明显异常
- 变更参数组合（仅技术分析 vs 全分析师，低深度 vs 高深度），验证报告内容有明显差异
- 使用错误股票代码触发失败，确认错误提示清晰且任务状态正确标记为失败

### 5.6 批量分析与任务中心（P1）
- 提交包含多只股票的批量分析任务，覆盖不同市场
- 在任务中心查看：
  - 任务列表展示状态、时间、发起人等关键信息
  - 状态流转正确（排队 → 运行中 → 成功 / 失败）
- 从任务中心进入任务详情，能查看对应报告
- 对运行中任务执行取消操作，任务最终状态为“已取消”，worker 停止后续处理

### 5.7 股票详情、筛选与自选股（P1）
- 股票搜索：支持按代码/名称模糊查询，多市场标识清晰
- 股票详情页：展示基本信息、技术指标、历史走势、历史分析记录
- 条件筛选：按市值、估值、行业、涨跌幅等组合条件筛选，结果数量与预期大致一致
- 自选股：在详情页添加/移除自选，在自选股列表中验证展示和跳转

### 5.8 新闻与社交媒体分析（P1）

> ⚠️ **Reddit 功能说明**：Reddit 社交媒体分析依赖离线数据，默认安装下不可用。测试重点是验证系统的回退机制，而非 Reddit 功能本身。详见 `docs/troubleshooting/reddit-data-setup.md`
- 对至少 1 只股票运行包含新闻/社交分析的任务：
  - 报告中有新闻摘要、情绪评估、重要事件与风险提示
- 当新闻源或社交媒体接口不可用时：
  - 报告中给出“暂无法获取新闻/社交数据”等友好说明
  - 其他分析模块仍可正常返回

### 5.9 报告查看与导出（P0–P1）
- 在报告详情页检查：
  - 各模块内容完整、Markdown 渲染正常、图表展示正确
- 尝试导出 1 份及以上报告（Markdown / Word / PDF 中至少 1–2 种）：
  - 文件生成成功，可在本地打开阅览，无乱码或明显排版错误
- 对同一报告连续导出多次，不产生异常空文件或报错

### 5.10 通知中心与消息（P1）
- 提交分析任务后，在通知中心或右上角观察到任务完成通知
- 如果支持系统公告/站内信：
  - 新建、查看、撤回公告的完整流程
- 在浏览器短暂断网再恢复，通知通道可恢复或给出刷新提示

### 5.11 学习中心与内置文档（P0–P1）
- 学习中心首页：分类卡片与推荐文章可点击
- 分类页：文章列表展示标题、简介、阅读时长、标签等信息
- 文章详情页（如 `/learning/article/what-is-llm`）：
  - 标题、目录（TOC）、图片、代码块等 Markdown 渲染正确
  - 文内指向其他 Markdown 文章的链接可跳转到站内对应页面
  - 指向微信/外部文档的链接在新标签打开

### 5.12 日志与故障排查支持（P1–P2）
- 常规操作（登录、分析、同步、配置修改）在日志与操作记录中可追踪
- 人为制造 1–2 个失败任务，确认：
  - 失败原因在前端展示清晰
  - 后端日志中有足够上下文便于排查

### 5.13 旧版 Streamlit 界面冒烟（可选，P2）
- 按 web/README.md 启动 Streamlit 应用
- 验证：至少完成 1 次简单单股分析，参数配置与结果展示无严重问题
- 如发现与新前端在数据/结果上有差异，记录并评估是否需要修复

## 6. 测试执行策略与产出
- 执行顺序：先完成 P0 冒烟 → P1 核心功能 → P2 异常与扩展场景
- 建议使用统一用例表（Excel/Markdown）记录：用例编号、前置条件、步骤、预期结果、实际结果
- 每一轮回归后输出简单测试报告，至少包含：
  - 覆盖模块列表与未覆盖项
  - 发现的问题及严重程度
  - 是否建议对外发布 / 升级用户

