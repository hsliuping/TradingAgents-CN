<!--
 * @Author: zhengweicheng 46236959+zwczwczwc@users.noreply.github.com
 * @Date: 2025-12-23 23:43:54
 * @LastEditors: zhengweicheng 46236959+zwczwczwc@users.noreply.github.com
 * @LastEditTime: 2025-12-23 23:43:55
 * @FilePath: /TradingAgents-CN-Test/文档/P0需求一：指数分析workflow/阶段六：前端适配与交互优化/开发计划/01-基础与类型适配.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
# 阶段六实施细节 - 任务一：基础与类型适配

本任务关注数据结构的基础定义，为后续的逻辑隔离与数据展示提供类型支撑。

## 1. 分析师常量定义更新 (`frontend/src/constants/analysts.ts`)

### 目标
为 `Analyst` 接口增加 `category` 字段，并据此对现有和新增的 Agent 进行分类标记，实现个股与指数分析师的逻辑分组。

### 详细步骤
1.  **修改接口定义**:
    ```typescript
    export interface Analyst {
      // ... existing fields
      category: 'stock' | 'index' | 'common'; // 新增
    }
    ```
2.  **更新现有数据**:
    - `fundamentals`, `news`, `social`: 标记为 `category: 'stock'`
    - `market`: 标记为 `category: 'common'`
3.  **新增指数分析师**:
    - `macro`: 宏观分析师 (`index`)
    - `policy`: 政策分析师 (`index`)
    - `sector`: 行业分析师 (`index`)
    - `technical_index`: 技术分析师(指数) (`index`)
    - `intl_news`: 国际新闻分析师 (`index`)
    - `bull_bear`: 多空博弈 (`index`)
    - `risk`: 风险裁判 (`index`)

## 2. 验证器增强 (`frontend/src/utils/stockValidator.ts`)

### 目标
打破仅支持 6 位数字的限制，增加对指数代码（如 `000001.SH`）的合法性校验。

### 详细步骤
1.  **新增 `validateIndexStock` 函数**:
    - **输入**: 字符串代码
    - **逻辑**:
        - 匹配正则 `/^\d{6}\.(SH|SZ)$/` -> 返回有效，市场类型为 'A股指数'。
        - 匹配正则 `/^\d{6}$/` -> 返回有效（宽容模式），提示用户或自动补全后缀。
        - 其他 -> 返回无效。
    - **输出**: `StockValidationResult`

## 3. 类型定义扩展 (`frontend/src/types/analysis.ts`)

### 目标
确保前端 TypeScript 类型能够覆盖后端返回的所有新字段，避免类型报错。

### 详细步骤
1.  **扩展 `AnalysisResult` 接口**:
    ```typescript
    export interface AnalysisResult {
      // ... existing fields
      
      // 指数分析特有字段
      macro_analysis?: string;      // 宏观
      policy_analysis?: string;     // 政策
      sector_analysis?: string;     // 行业
      intl_news_analysis?: string;  // 国际新闻 (Text or JSON string)
      debate_summary?: {            // 多空辩论
        bull_point: string;
        bear_point: string;
        conclusion: string;
      } | string;
      risk_assessment?: {           // 风险评估
        level: string;
        suggestion: string;
      } | string;
    }
    ```

## 4. API 请求参数调整 (`frontend/src/api/analysis.ts`)

### 目标
确保发起请求时能够携带 `analysis_type` 参数，供后端路由使用。

### 详细步骤
1.  **检查 `SingleAnalysisRequest`**:
    - 确认 `parameters` 字段为 `Record<string, any>` 或包含明确的 `analysis_type` 字段。
    - 如果没有，需显式添加 `analysis_type?: 'stock' | 'index'`。
