<!--
 * @Author: zhengweicheng 46236959+zwczwczwc@users.noreply.github.com
 * @Date: 2025-12-20 01:21:50
 * @LastEditors: zhengweicheng 46236959+zwczwczwc@users.noreply.github.com
 * @LastEditTime: 2025-12-20 01:21:51
 * @FilePath: /TradingAgents-CN-Test/文档/P0需求一：指数分析workflow/阶段三：数据源优化与决策增强/设计文档/数据源优化需求说明.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
# 阶段三：数据源优化与决策增强 - 需求说明书

## 1. 背景与目标

### 1.1 背景
当前系统（v2.1.0）主要基于 AKShare 开源接口构建，数据获取逻辑较为简单，主要依赖缓存机制服务于日度分析。虽然架构清晰，但在面对**实盘辅助决策**场景时，存在以下不足：
- **数据源单点风险**: 过度依赖 AKShare，一旦上游接口变动，系统将瘫痪。
- **实时性不足**: 现有缓存策略（1-24小时）无法满足早盘和尾盘的瞬时决策需求。
- **数据深度有限**: 缺乏更权威的宏观/政策数据源及深度的市场微观结构数据（如分时成交、逐笔委托）。

### 1.2 目标
构建一个**生产级、高可用、低延迟**的数据底座，支持指数板块的实盘辅助决策。
- **决策场景覆盖**:
    - **早盘 (9:30 - 10:00)**: 捕捉开盘情绪、隔夜消息影响、主力资金首攻方向。
    - **尾盘 (14:30 - 15:00)**: 确认全天趋势、识别尾盘突袭/跳水、辅助隔夜持仓决策。
    - **盘后 (15:30+)**: 深度复盘、政策汇总、外盘联动分析。
- **数据质量要求**: 准确性 > 99%，核心数据延迟 < 1分钟（盘中）。

## 2. 详细功能需求

### 2.1 数据源多元化 (Multi-Source Strategy)
| 数据类型 | 当前来源 (v2.1.0) | 目标来源 (v3.0.0) | 优先级策略 |
| :--- | :--- | :--- | :--- |
| **基础行情** | AKShare | **Tushare Pro (API)** + AKShare + Baostock | Tushare > AKShare > Baostock |
| **实时资金流** | AKShare (东财) | **Tushare/Sina直连** + AKShare | 实时接口优先，自动降级 |
| **宏观数据** | AKShare | **Tushare** + 国家统计局官网(规划) + AKShare | 交叉验证，取最新更新者 |
| **政策/新闻** | 新闻联播/东财 | **权威媒资API** + 政府官网 + 研报摘要 | 增加信源权重，优先权威发布 |

### 2.2 场景化数据服务
系统需根据当前时间自动切换数据服务模式：

#### A. 早盘模式 (Morning Session)
- **触发时间**: 交易日 09:15 - 10:00
- **核心数据**:
    - 国际市场隔夜表现 (美股收盘、A50期指)。
    - 集合竞价异动 (高开/低开板块)。
    - 开盘15分钟/30分钟资金净流入 Top 板块。
    - 市场情绪指标 (涨跌家数比、炸板率)。

#### B. 尾盘模式 (Afternoon Session)
- **触发时间**: 交易日 14:30 - 15:00
- **核心数据**:
    - 全天资金流向锁定。
    - 尾盘异动板块 (最后30分钟放量/抢筹)。
    - 北向资金流向 (若有)。
    - 关键指数技术位确认 (是否站稳均线)。

#### C. 盘后模式 (Post-Market Session)
- **触发时间**: 交易日 15:30 后
- **核心数据**:
    - 龙虎榜数据 (机构席位买卖)。
    - 晚间政策/公告。
    - 深度研报观点。

### 2.3 数据质量与监控
- **健康检查**: 每次任务执行前自动检测各数据源连通性。
- **自动切换**: 主数据源失败时，自动无缝切换至备用源，并记录日志。
- **异常报警**: 连续3次获取失败触发系统级告警。

### 2.4 技术面分析数据 (Technical Analysis Data)
为了支持技术面分析Agent的决策，需提供以下数据：
- **历史行情**: 指数日线/周线/月线 OHLCV 数据 (至少近3年)。
- **分钟行情**: 1分钟/5分钟/15分钟/30分钟/60分钟 K线数据 (用于盘中实时分析)。
- **技术指标**: 
    - 趋势指标: MA (均线), MACD, BOLL (布林带)。
    - 震荡指标: RSI, KDJ, WR (威廉指标)。
    - 成交量指标: OBV, VOL-MA。
- **形态识别**: 常见K线组合 (早晨之星、乌云盖顶等) 及 关键支撑/压力位。

## 3. 非功能需求
- **性能**: 盘中数据接口响应时间 < 3秒。
- **稳定性**: 即使单一数据源完全失效，系统核心功能（行情、简单资金流）仍能运行。
- **扩展性**: 预留 Paid API (如 Wind/Choice 插件) 接入接口。
