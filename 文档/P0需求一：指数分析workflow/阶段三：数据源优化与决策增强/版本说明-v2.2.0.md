# 版本说明 v2.2.0 (Phase 3: 数据源优化与决策增强)

## 📅 发布日期
2025-12-20

## 🎯 核心目标
本版本针对“实盘辅助决策”场景进行深度优化，重点解决 v2.1.0 版本中数据源单一、时效性不足的问题，并引入“早盘/尾盘”分时决策逻辑，打造生产级的数据底座。

## ✨ 新增特性 (Features)

### 1. 混合数据架构 (Hybrid Data Architecture)
- **多源融合**: 引入 `Tushare Pro` 作为主数据源，`AKShare` 作为辅助，`Baostock` 作为兜底。
- **智能路由**: 根据数据源健康状况自动切换，确保高可用性。
- **数据降级**: 当 Tushare 积分不足或限流时，自动降级至免费源。

### 2. 实时监控引擎 (Realtime Engine - Option A)
- **轻量化设计**: 采用 "Lazy Load" 模式，仅在决策运行时触发，无后台常驻进程。
- **秒级穿透**: 支持 `use_realtime=True` 强制绕过长周期缓存，获取 1-5 分钟内的最新行情。
- **场景化快照**: 提供 `MorningSnapshot` (早盘竞价/开盘) 和 `ClosingSnapshot` (尾盘抢筹/趋势) 数据结构。

### 3. 分时决策体系 (Time-Aware Decision)
- **早盘模式 (Morning Mode)**: 09:15 - 10:00，侧重分析隔夜外盘、集合竞价、开盘资金流向。
- **尾盘模式 (Afternoon Mode)**: 14:30 - 15:00，侧重分析全天趋势确认、尾盘突袭资金。
- **盘后模式 (Post-Market Mode)**: 15:30+，侧重全天复盘与次日展望 (原有逻辑增强)。

### 4. 技术分析师 (Technical Analyst)
- 新增独立 Agent，专注于量化技术指标分析 (MA, RSI, KDJ, MACD)。
- 提供纯技术面的仓位控制建议，与宏观/基本面分析形成互补。

## 🛠 技术改进 (Technical Improvements)
- **工厂模式**: 重构 `IndexDataProvider`，支持插件式扩展新的数据源。
- **内存短缓存**: 引入 5 分钟级内存缓存，防止单次运行中的重复 API 调用。
- **CLI 增强**: `main.py` 新增 `--session` 参数支持场景切换。

## 📝 文档更新
- 新增 [阶段三：数据源优化与决策增强](.) 完整文档集。
- 更新 [开发计划](开发计划/00-总体规划.md)，采用“设计先行”的开发流程。

## ⚠️ 升级注意
- 需申请 Tushare Token 并在 `config.yaml` 中配置 (可选，不配置则自动降级)。
- 依赖库新增: `tushare`, `pandas-ta` (或 `talib`)。
