<!--
 * @Author: zhengweicheng 46236959+zwczwczwc@users.noreply.github.com
 * @Date: 2025-12-20 01:21:52
 * @LastEditors: zhengweicheng 46236959+zwczwczwc@users.noreply.github.com
 * @LastEditTime: 2025-12-20 01:58:07
 * @FilePath: /TradingAgents-CN-Test/文档/P0需求一：指数分析workflow/阶段三：数据源优化与决策增强/开发计划/00-总体规划.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
# 阶段三开发计划：数据源优化与决策增强

## 0. 总体规划
本阶段开发预计周期为 2 周，重点在于数据底座的重构和实盘场景的适配。

## 1. 里程碑 (Milestones)

### M0: 详细设计 (Detailed Design)
- **目标**: 完成各子模块的详细设计文档，确认技术方案。
- **交付物**:
    - `设计文档/01-混合数据源详细设计.md`
    - `设计文档/02-实时监控引擎详细设计.md`
    - `设计文档/03-Agent升级详细设计.md`

### M1: 数据层重构 (Data Layer Refactoring)
- **目标**: 完成 Hybrid Data Provider 架构，接入 Tushare。
- **交付物**: 
    - `tradingagents/dataflows/providers/tushare_provider.py`
    - `tradingagents/dataflows/hybrid_provider.py`
    - 数据源健康检查机制。

### M2: 实时监控引擎 (Realtime Engine)
- **目标**: 实现轻量级盘中数据监控 (Option A: Lazy Load Mode)。
- **交付物**:
    - `tradingagents/dataflows/realtime_monitor.py` (Lazy Load Implementation)
    - 早盘/尾盘数据聚合接口。

### M3: Agent 能力升级 (Agent Upgrade)
- **目标**: 让 Agent 能够根据时间上下文请求不同数据，并引入技术面分析。
- **交付物**:
    - 新增 `TechnicalAnalyst` (技术分析师)。
    - 更新后的 `MacroAnalyst`, `SectorAnalyst`。
    - 新增 `TimeAwareStrategyAdvisor` (时间感知策略顾问)。

### M4: 集成测试与实盘模拟 (Integration & Simulation)
- **目标**: 验证早盘、尾盘流程的完整性。
- **交付物**:
    - 模拟盘测试报告。
    - 每日复盘自动生成脚本。

## 2. 任务细分 (Task Breakdown)

### Week 0: 详细设计 (Design Phase)
- [ ] **Task 0.1**: 编写混合数据源详细设计文档。
- [ ] **Task 0.2**: 编写实时监控引擎详细设计文档 (基于 Option A)。
- [ ] **Task 0.3**: 编写 Agent 升级详细设计文档。

### Week 1: 数据底座建设
- [x] **Task 1.1**: 申请并配置 Tushare Token，编写基础连接测试脚本。
- [x] **Task 1.2**: 封装 `TushareProvider`，实现宏观、指数日线接口。
- [x] **Task 1.3**: 改造 `IndexDataProvider` 为工厂模式，支持多源切换。
- [x] **Task 1.4**: 开发 `RealtimeMarketMonitor`，重点攻克实时资金流数据的稳定性。
- [x] **Task 1.5**: 封装技术指标计算库 (基于 `pandas-ta` 或 `talib`)。

### Week 2: Agent 适配与流程串联
- [x] **Task 2.1**: 修改 `fetch_macro_data` 等工具，使其支持从 Hybrid Provider 获取数据。
- [x] **Task 2.2**: 开发 `TechnicalAnalyst`，实现趋势判断与超买超卖逻辑。
- [x] **Task 2.3**: 升级 `Sector Analyst` Prompt，加入早盘/尾盘分析逻辑。
- [x] **Task 2.4**: 重构 `StrategyAdvisor`，融合技术面分析结果。
- [ ] **Task 2.5**: 开发主控脚本 `main_trading_assistant.py`，支持 CLI 参数 `--session morning/afternoon/post`。
- [ ] **Task 2.6**: **集成 APScheduler 定时任务**，注册早盘(09:45)/尾盘(14:35)自动触发器。
- [x] **Task 2.7**: 全链路联调测试。

## 3. 风险管理
- **Tushare 积分不足**: 需提供降级方案，若用户无积分，或调用失败，请打印日志并自动回退到 AKShare。
- **API 限流**: 实现指数退避算法 (Exponential Backoff)。
- **网络波动**: 增加本地文件缓存 (FileCache) 作为最后的兜底。
