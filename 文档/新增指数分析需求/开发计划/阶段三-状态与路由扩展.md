# é˜¶æ®µä¸‰ï¼šçŠ¶æ€ä¸è·¯ç”±æ‰©å±•å¼€å‘æ–¹æ¡ˆ

## ğŸ“‹ é˜¶æ®µæ¦‚è¿°

**ç›®æ ‡**ï¼šæ‰©å±•ç³»ç»ŸçŠ¶æ€ç®¡ç†å’Œè·¯ç”±é€»è¾‘ï¼Œä¸ºæŒ‡æ•°åˆ†ææµç¨‹æä¾›åŸºç¡€è®¾æ–½æ”¯æŒã€‚

**é¢„è®¡æ—¶é—´**ï¼š1-2å¤©  
**ä¼˜å…ˆçº§**ï¼šğŸ”´ é«˜ï¼ˆæ¶æ„æ ¸å¿ƒï¼‰

**å‰ç½®æ¡ä»¶**ï¼š
- é˜¶æ®µä¸€ï¼ˆæ•°æ®å±‚ä¸å·¥å…·å±‚ï¼‰å·²å®Œæˆ
- é˜¶æ®µäºŒï¼ˆAgentèŠ‚ç‚¹å®ç°ï¼‰å·²å®Œæˆ

---

## ğŸ¯ æœ¬é˜¶æ®µäº¤ä»˜ç‰©

### ä¿®æ”¹æ–‡ä»¶
1. `tradingagents/agents/utils/agent_states.py` - æ‰©å±•AgentState
2. `tradingagents/graph/conditional_logic.py` - æ‰©å±•è·¯ç”±é€»è¾‘

### æµ‹è¯•æ–‡ä»¶
3. `tests/utils/test_agent_states.py` - çŠ¶æ€æµ‹è¯•
4. `tests/graph/test_conditional_logic.py` - è·¯ç”±é€»è¾‘æµ‹è¯•
5. `tests/integration/test_state_compatibility.py` - å…¼å®¹æ€§æµ‹è¯•

---

## ğŸ“ è¯¦ç»†å¼€å‘ä»»åŠ¡

### ä»»åŠ¡3.1ï¼šæ‰©å±•AgentState

**æ–‡ä»¶**ï¼š`tradingagents/agents/utils/agent_states.py`

**ä¿®æ”¹ç›®æ ‡**ï¼š
- âœ… é›¶ç ´åæ€§ä¿®æ”¹ï¼ˆä¸ä¿®æ”¹ç°æœ‰å­—æ®µï¼‰
- âœ… æ·»åŠ è·¯ç”±æ ‡è¯†å­—æ®µ `is_index`
- âœ… æ·»åŠ æŒ‡æ•°åˆ†æä¸“ç”¨å­—æ®µ
- âœ… ä¿æŒå‘åå…¼å®¹æ€§

**ä¿®æ”¹æ¸…å•**ï¼š
- [ ] æ·»åŠ è·¯ç”±æ ‡è¯†å­—æ®µ
  ```python
  # ========== è·¯ç”±æ ‡è¯† (æ–°å¢) ==========
  is_index: Annotated[bool, "True for index analysis, False for stock analysis"]
  ```

- [ ] æ·»åŠ å®è§‚åˆ†æå­—æ®µ
  ```python
  macro_report: Annotated[str, "Report from Macro Analyst (JSON format with confidence)"]
  macro_tool_call_count: Annotated[int, "Macro analyst tool call counter"]
  ```

- [ ] æ·»åŠ æ”¿ç­–åˆ†æå­—æ®µ
  ```python
  policy_report: Annotated[str, "Report from Policy Analyst (JSON format with confidence)"]
  policy_tool_call_count: Annotated[int, "Policy analyst tool call counter"]
  ```

- [ ] æ·»åŠ æ¿å—åˆ†æå­—æ®µ
  ```python
  sector_report: Annotated[str, "Report from Sector Analyst (JSON format with confidence)"]
  sector_tool_call_count: Annotated[int, "Sector analyst tool call counter"]
  ```

- [ ] æ·»åŠ ç­–ç•¥æŠ¥å‘Šå­—æ®µ
  ```python
  strategy_report: Annotated[str, "Final strategy report from Strategy Advisor"]
  ```

**å‚è€ƒä»£ç ä½ç½®**ï¼šè¯¦ç»†è®¾è®¡æ–‡æ¡£ ç¬¬1.1èŠ‚

**å®Œæ•´ä¿®æ”¹ç¤ºä¾‹**ï¼š
```python
# tradingagents/agents/utils/agent_states.py

from typing import Annotated
from langgraph.graph import MessagesState

class AgentState(MessagesState):
    """å…¨å±€çŠ¶æ€ï¼Œæ”¯æŒä¸ªè‚¡åˆ†æå’ŒæŒ‡æ•°åˆ†æä¸¤ç§æ¨¡å¼"""
    
    # ========== é€šç”¨å­—æ®µ ==========
    company_of_interest: Annotated[str, "Company/Index code we are analyzing"]
    trade_date: Annotated[str, "Trading date"]
    sender: Annotated[str, "Agent that sent this message"]
    
    # ========== è·¯ç”±æ ‡è¯† (æ–°å¢) ==========
    is_index: Annotated[bool, "True for index analysis, False for stock analysis"]
    
    # ========== ä¸ªè‚¡åˆ†æå­—æ®µ (ç°æœ‰ï¼Œä¿æŒä¸å˜) ==========
    market_report: Annotated[str, "Report from the Market Analyst"]
    sentiment_report: Annotated[str, "Report from the Social Media Analyst"]
    news_report: Annotated[str, "Report from the News Researcher"]
    fundamentals_report: Annotated[str, "Report from the Fundamentals Researcher"]
    
    market_tool_call_count: Annotated[int, "Market analyst tool call counter"]
    news_tool_call_count: Annotated[int, "News analyst tool call counter"]
    sentiment_tool_call_count: Annotated[int, "Social media analyst tool call counter"]
    fundamentals_tool_call_count: Annotated[int, "Fundamentals analyst tool call counter"]
    
    investment_debate_state: Annotated[InvestDebateState, "Debate state"]
    investment_plan: Annotated[str, "Investment plan from Research Manager"]
    trader_investment_plan: Annotated[str, "Plan from Trader"]
    
    risk_debate_state: Annotated[RiskDebateState, "Risk debate state"]
    final_trade_decision: Annotated[str, "Final decision from Risk Judge"]
    
    # ========== æŒ‡æ•°åˆ†æå­—æ®µ (æ–°å¢) ==========
    macro_report: Annotated[str, "Report from Macro Analyst (JSON format with confidence)"]
    macro_tool_call_count: Annotated[int, "Macro analyst tool call counter"]
    
    policy_report: Annotated[str, "Report from Policy Analyst (JSON format with confidence)"]
    policy_tool_call_count: Annotated[int, "Policy analyst tool call counter"]
    
    sector_report: Annotated[str, "Report from Sector Analyst (JSON format with confidence)"]
    sector_tool_call_count: Annotated[int, "Sector analyst tool call counter"]
    
    strategy_report: Annotated[str, "Final strategy report from Strategy Advisor"]
```

**éªŒè¯è¦ç‚¹**ï¼š
- âœ… å¯¼å…¥è¯­å¥å®Œæ•´
- âœ… å­—æ®µç±»å‹æ³¨è§£æ­£ç¡®
- âœ… å­—æ®µæè¿°æ¸…æ™°
- âœ… ä¸å½±å“ç°æœ‰å­—æ®µ

---

### ä»»åŠ¡3.2ï¼šæ‰©å±•ConditionalLogicè·¯ç”±

**æ–‡ä»¶**ï¼š`tradingagents/graph/conditional_logic.py`

**ä¿®æ”¹ç›®æ ‡**ï¼š
- âœ… æ·»åŠ 4ä¸ªæ–°çš„è·¯ç”±æ–¹æ³•
- âœ… éµå¾ªç°æœ‰è·¯ç”±æ–¹æ³•çš„æ¨¡å¼
- âœ… å®ç°å·¥å…·è°ƒç”¨è®¡æ•°å™¨æ£€æŸ¥
- âœ… å®ç°æŠ¥å‘Šå®Œæˆåº¦æ£€æŸ¥

**ä¿®æ”¹æ¸…å•**ï¼š
- [ ] æ·»åŠ  `should_continue_macro()` æ–¹æ³•
- [ ] æ·»åŠ  `should_continue_policy()` æ–¹æ³•
- [ ] æ·»åŠ  `should_continue_sector()` æ–¹æ³•
- [ ] æ·»åŠ  `should_continue_strategy()` æ–¹æ³•

**å‚è€ƒä»£ç ä½ç½®**ï¼šè¯¦ç»†è®¾è®¡æ–‡æ¡£ ç¬¬4.1èŠ‚

**å®ç°æ¨¡æ¿** (ä»¥should_continue_macroä¸ºä¾‹)ï¼š
```python
def should_continue_macro(self, state: AgentState):
    """Determine if macro analysis should continue."""
    from tradingagents.utils.logging_init import get_logger
    logger = get_logger("agents")
    
    messages = state["messages"]
    last_message = messages[-1]
    
    # å·¥å…·è°ƒç”¨è®¡æ•°å™¨
    tool_call_count = state.get("macro_tool_call_count", 0)
    max_tool_calls = 3
    
    # æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰å®è§‚åˆ†ææŠ¥å‘Š
    macro_report = state.get("macro_report", "")
    
    logger.info(f"ğŸ”€ [æ¡ä»¶åˆ¤æ–­] should_continue_macro")
    logger.info(f"ğŸ”€ [æ¡ä»¶åˆ¤æ–­] - æŠ¥å‘Šé•¿åº¦: {len(macro_report)}")
    logger.info(f"ğŸ”§ [æ­»å¾ªç¯ä¿®å¤] - å·¥å…·è°ƒç”¨æ¬¡æ•°: {tool_call_count}/{max_tool_calls}")
    
    # å¦‚æœè¾¾åˆ°æœ€å¤§å·¥å…·è°ƒç”¨æ¬¡æ•°ï¼Œå¼ºåˆ¶ç»“æŸ
    if tool_call_count >= max_tool_calls:
        logger.warning(f"ğŸ”§ [æ­»å¾ªç¯ä¿®å¤] è¾¾åˆ°æœ€å¤§å·¥å…·è°ƒç”¨æ¬¡æ•°ï¼Œå¼ºåˆ¶ç»“æŸ: Msg Clear Macro")
        return "Msg Clear Macro"
    
    # å¦‚æœå·²ç»æœ‰æŠ¥å‘Šå†…å®¹ï¼Œè¯´æ˜åˆ†æå·²å®Œæˆ
    if macro_report and len(macro_report) > 100:
        logger.info(f"ğŸ”€ [æ¡ä»¶åˆ¤æ–­] âœ… æŠ¥å‘Šå·²å®Œæˆï¼Œè¿”å›: Msg Clear Macro")
        return "Msg Clear Macro"
    
    # æ£€æŸ¥æ˜¯å¦æœ‰å·¥å…·è°ƒç”¨
    if hasattr(last_message, 'tool_calls') and last_message.tool_calls:
        logger.info(f"ğŸ”€ [æ¡ä»¶åˆ¤æ–­] ğŸ”§ æ£€æµ‹åˆ°tool_callsï¼Œè¿”å›: tools_macro")
        return "tools_macro"
    
    logger.info(f"ğŸ”€ [æ¡ä»¶åˆ¤æ–­] âœ… æ— tool_callsï¼Œè¿”å›: Msg Clear Macro")
    return "Msg Clear Macro"
```

**ç‰¹æ®Šå¤„ç† - should_continue_strategy**ï¼š
```python
def should_continue_strategy(self, state: AgentState):
    """Determine if strategy advisory should continue."""
    # Strategy Advisor ä¸è°ƒç”¨å·¥å…·ï¼Œæ‰€ä»¥é€šå¸¸ä¸€æ¬¡å°±å®Œæˆ
    strategy_report = state.get("strategy_report", "")
    
    # å¦‚æœå·²ç»æœ‰æŠ¥å‘Šï¼Œç›´æ¥ç»“æŸ
    if strategy_report and len(strategy_report) > 100:
        return "Msg Clear Strategy"
    
    # Strategy Advisor ç†è®ºä¸Šä¸åº”è¯¥è°ƒç”¨å·¥å…·
    if hasattr(last_message, 'tool_calls') and last_message.tool_calls:
        logger.warning("âš ï¸ Strategy Advisor ä¸åº”è°ƒç”¨å·¥å…·")
        return "Msg Clear Strategy"  # å¼ºåˆ¶ç»“æŸ
    
    return "Msg Clear Strategy"
```

**éªŒè¯è¦ç‚¹**ï¼š
- âœ… æ–¹æ³•ç­¾åä¸ç°æœ‰æ–¹æ³•ä¸€è‡´
- âœ… è¿”å›å€¼ç±»å‹æ­£ç¡®ï¼ˆstrï¼‰
- âœ… æ—¥å¿—è®°å½•å®Œæ•´
- âœ… é€»è¾‘ä¸ç°æœ‰æ–¹æ³•ä¿æŒä¸€è‡´

---

### ä»»åŠ¡3.3ï¼šç¼–å†™æµ‹è¯•ç”¨ä¾‹

**æµ‹è¯•ç›®æ ‡**ï¼š
- âœ… éªŒè¯AgentStateæ‰©å±•åçš„å…¼å®¹æ€§
- âœ… éªŒè¯è·¯ç”±é€»è¾‘çš„æ­£ç¡®æ€§
- âœ… éªŒè¯ä¸ªè‚¡åˆ†ææµç¨‹ä¸å—å½±å“

#### test_agent_states.py
```python
import pytest
from tradingagents.agents.utils.agent_states import AgentState

def test_agent_state_stock_mode():
    """æµ‹è¯•ä¸ªè‚¡æ¨¡å¼çš„çŠ¶æ€åˆå§‹åŒ–"""
    state = AgentState(
        messages=[],
        company_of_interest="600519",
        trade_date="2024-12-10",
        is_index=False,
        market_report="",
        market_tool_call_count=0
    )
    
    assert state["is_index"] == False
    assert state["company_of_interest"] == "600519"
    # æŒ‡æ•°å­—æ®µåº”è¯¥ä¸è¢«è®¿é—®
    assert state.get("macro_report", "") == ""

def test_agent_state_index_mode():
    """æµ‹è¯•æŒ‡æ•°æ¨¡å¼çš„çŠ¶æ€åˆå§‹åŒ–"""
    state = AgentState(
        messages=[],
        company_of_interest="sh000001",
        trade_date="2024-12-10",
        is_index=True,
        macro_report="",
        macro_tool_call_count=0
    )
    
    assert state["is_index"] == True
    assert state["company_of_interest"] == "sh000001"
    # ä¸ªè‚¡å­—æ®µåº”è¯¥ä¸è¢«è®¿é—®
    assert state.get("market_report", "") == ""

def test_agent_state_field_types():
    """æµ‹è¯•å­—æ®µç±»å‹"""
    state = AgentState(
        messages=[],
        company_of_interest="sh000001",
        trade_date="2024-12-10",
        is_index=True,
        macro_tool_call_count=0,
        policy_tool_call_count=0,
        sector_tool_call_count=0
    )
    
    assert isinstance(state["is_index"], bool)
    assert isinstance(state["macro_tool_call_count"], int)
```

#### test_conditional_logic.py
```python
import pytest
from tradingagents.graph.conditional_logic import ConditionalLogic
from tradingagents.agents.utils.agent_states import AgentState

@pytest.fixture
def logic():
    return ConditionalLogic()

def test_should_continue_macro_no_report(logic):
    """æµ‹è¯•å®è§‚åˆ†æè·¯ç”± - æ— æŠ¥å‘Šæ—¶"""
    state = {
        "messages": [],
        "macro_report": "",
        "macro_tool_call_count": 0
    }
    
    # æ¨¡æ‹Ÿæœ‰å·¥å…·è°ƒç”¨çš„æ¶ˆæ¯
    from types import SimpleNamespace
    last_message = SimpleNamespace(tool_calls=[{"name": "fetch_macro_data"}])
    state["messages"] = [last_message]
    
    result = logic.should_continue_macro(state)
    assert result == "tools_macro"

def test_should_continue_macro_with_report(logic):
    """æµ‹è¯•å®è§‚åˆ†æè·¯ç”± - æœ‰æŠ¥å‘Šæ—¶"""
    state = {
        "messages": [],
        "macro_report": '{"economic_cycle": "å¤è‹", "confidence": 0.8}',
        "macro_tool_call_count": 1
    }
    
    result = logic.should_continue_macro(state)
    assert result == "Msg Clear Macro"

def test_should_continue_macro_max_calls(logic):
    """æµ‹è¯•å®è§‚åˆ†æè·¯ç”± - è¾¾åˆ°æœ€å¤§è°ƒç”¨æ¬¡æ•°"""
    state = {
        "messages": [],
        "macro_report": "",
        "macro_tool_call_count": 3  # å·²è¾¾åˆ°æœ€å¤§æ¬¡æ•°
    }
    
    result = logic.should_continue_macro(state)
    assert result == "Msg Clear Macro"

def test_should_continue_strategy_no_tools(logic):
    """æµ‹è¯•ç­–ç•¥é¡¾é—®è·¯ç”± - ä¸åº”è°ƒç”¨å·¥å…·"""
    state = {
        "messages": [],
        "strategy_report": "",
    }
    
    # æ¨¡æ‹Ÿæ— å·¥å…·è°ƒç”¨çš„æ¶ˆæ¯
    from types import SimpleNamespace
    last_message = SimpleNamespace()
    state["messages"] = [last_message]
    
    result = logic.should_continue_strategy(state)
    assert result == "Msg Clear Strategy"
```

#### test_state_compatibility.py
```python
import pytest
from tradingagents.agents.utils.agent_states import AgentState

def test_backward_compatibility_stock_analysis():
    """æµ‹è¯•å‘åå…¼å®¹æ€§ - ä¸ªè‚¡åˆ†ææµç¨‹"""
    # æ¨¡æ‹Ÿç°æœ‰ä¸ªè‚¡åˆ†ææµç¨‹çš„çŠ¶æ€åˆå§‹åŒ–
    state = AgentState(
        messages=[],
        company_of_interest="600519",
        trade_date="2024-12-10",
        # æ³¨æ„ï¼šä¸è®¾ç½® is_indexï¼Œåº”è¯¥ä¸å½±å“ç°æœ‰æµç¨‹
        market_report="",
        news_report="",
        sentiment_report="",
        fundamentals_report=""
    )
    
    # éªŒè¯ç°æœ‰å­—æ®µå¯ä»¥æ­£å¸¸è®¿é—®
    assert "market_report" in state
    assert "news_report" in state
    
    # éªŒè¯æ–°å­—æ®µä¸ä¼šè¢«æ„å¤–è®¿é—®
    assert state.get("macro_report", None) is None or state.get("macro_report", "") == ""

def test_no_field_conflict():
    """æµ‹è¯•å­—æ®µä¸å†²çª"""
    state = AgentState(
        messages=[],
        company_of_interest="sh000001",
        trade_date="2024-12-10",
        is_index=True,
        # åŒæ—¶è®¾ç½®ä¸ªè‚¡å’ŒæŒ‡æ•°å­—æ®µï¼ˆè™½ç„¶ä¸æ¨èï¼‰
        market_report="ä¸ªè‚¡æŠ¥å‘Š",
        macro_report="å®è§‚æŠ¥å‘Š"
    )
    
    # éªŒè¯å­—æ®µä¸ä¼šäº’ç›¸è¦†ç›–
    assert state["market_report"] == "ä¸ªè‚¡æŠ¥å‘Š"
    assert state["macro_report"] == "å®è§‚æŠ¥å‘Š"
```

---

## ğŸ”„ å¼€å‘æµç¨‹

### Day 1: AgentStateæ‰©å±•
1. **ä¸Šåˆ**
   - å¤‡ä»½åŸæœ‰ `agent_states.py`
   - æ·»åŠ æ–°å­—æ®µå®šä¹‰
   - éªŒè¯å¯¼å…¥æ— è¯¯
   
2. **ä¸‹åˆ**
   - ç¼–å†™çŠ¶æ€æµ‹è¯•ç”¨ä¾‹
   - è¿è¡Œæµ‹è¯•ï¼Œä¿®å¤é—®é¢˜
   - ç¼–å†™å…¼å®¹æ€§æµ‹è¯•

3. **éªŒæ”¶**
   - æ‰€æœ‰æµ‹è¯•é€šè¿‡
   - ç°æœ‰ä»£ç å¼•ç”¨agent_states.pyçš„åœ°æ–¹æ— æŠ¥é”™

### Day 2: ConditionalLogicæ‰©å±•
1. **ä¸Šåˆ**
   - å¤‡ä»½åŸæœ‰ `conditional_logic.py`
   - æ·»åŠ 4ä¸ªè·¯ç”±æ–¹æ³•
   - éªŒè¯æ–¹æ³•ç­¾åæ­£ç¡®
   
2. **ä¸‹åˆ**
   - ç¼–å†™è·¯ç”±é€»è¾‘æµ‹è¯•ç”¨ä¾‹
   - è¿è¡Œæµ‹è¯•ï¼Œä¿®å¤é—®é¢˜
   - Code Review

3. **éªŒæ”¶**
   - æ‰€æœ‰è·¯ç”±æ–¹æ³•æµ‹è¯•é€šè¿‡
   - é€»è¾‘ä¸ç°æœ‰æ–¹æ³•ä¿æŒä¸€è‡´
   - æ—¥å¿—è¾“å‡ºæ¸…æ™°

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] AgentStateæˆåŠŸæ·»åŠ æ‰€æœ‰æ–°å­—æ®µ
- [ ] is_indexå­—æ®µå¯ä»¥æ­£ç¡®åŒºåˆ†ä¸ªè‚¡å’ŒæŒ‡æ•°
- [ ] 4ä¸ªè·¯ç”±æ–¹æ³•å…¨éƒ¨å®ç°
- [ ] å·¥å…·è°ƒç”¨è®¡æ•°å™¨æ£€æŸ¥æ­£å¸¸å·¥ä½œ
- [ ] æŠ¥å‘Šå®Œæˆåº¦æ£€æŸ¥æ­£å¸¸å·¥ä½œ

### è´¨é‡éªŒæ”¶
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] å…¼å®¹æ€§æµ‹è¯•é€šè¿‡ï¼ˆç°æœ‰ä¸ªè‚¡æµç¨‹ä¸å—å½±å“ï¼‰
- [ ] ä»£ç ç¬¦åˆç°æœ‰é£æ ¼
- [ ] æ— pylint/flake8è­¦å‘Š

### å…¼å®¹æ€§éªŒæ”¶
- [ ] ç°æœ‰ä¸ªè‚¡åˆ†ææµç¨‹æ­£å¸¸è¿è¡Œ
- [ ] ä¸ªè‚¡å’ŒæŒ‡æ•°å­—æ®µä¸å†²çª
- [ ] çŠ¶æ€åˆå§‹åŒ–æ—¶æ–°å­—æ®µæœ‰åˆç†é»˜è®¤å€¼

---

## ğŸ“Š è¿›åº¦è·Ÿè¸ª

| ä»»åŠ¡ | è´Ÿè´£äºº | å¼€å§‹æ—¶é—´ | é¢„è®¡å®Œæˆ | å®é™…å®Œæˆ | çŠ¶æ€ |
|------|--------|----------|----------|----------|------|
| ä»»åŠ¡3.1 æ‰©å±•AgentState | - | - | Day 1 | - | ğŸ“‹ å¾…å¼€å§‹ |
| ä»»åŠ¡3.2 æ‰©å±•ConditionalLogic | - | - | Day 2 ä¸Šåˆ | - | ğŸ“‹ å¾…å¼€å§‹ |
| ä»»åŠ¡3.3 ç¼–å†™æµ‹è¯•ç”¨ä¾‹ | - | - | Day 1-2 | - | ğŸ“‹ å¾…å¼€å§‹ |
| å…¼å®¹æ€§éªŒè¯ | - | - | Day 2 ä¸‹åˆ | - | ğŸ“‹ å¾…å¼€å§‹ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ä¿®æ”¹é£é™©
1. **AgentStateæ˜¯æ ¸å¿ƒçŠ¶æ€** - ä»»ä½•é”™è¯¯éƒ½ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒ
   - å»ºè®®ï¼šå…ˆåœ¨åˆ†æ”¯ä¸Šä¿®æ”¹ï¼Œå……åˆ†æµ‹è¯•åå†åˆå¹¶
   
2. **å­—æ®µå‘½åå†²çª** - ç¡®ä¿æ–°å­—æ®µåä¸ä¸ç°æœ‰å­—æ®µå†²çª
   - å»ºè®®ï¼šä½¿ç”¨æ˜ç¡®çš„å‰ç¼€æˆ–åç¼€

3. **ç±»å‹æ³¨è§£é”™è¯¯** - ç±»å‹é”™è¯¯å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶å¼‚å¸¸
   - å»ºè®®ï¼šä»”ç»†æ£€æŸ¥ `Annotated` çš„ä½¿ç”¨

### æœ€ä½³å®è·µ
1. **å¤‡ä»½åŸæ–‡ä»¶** - ä¿®æ”¹å‰å…ˆå¤‡ä»½
2. **å¢é‡ä¿®æ”¹** - ä¸€æ¬¡æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œæµ‹è¯•é€šè¿‡åå†ç»§ç»­
3. **å……åˆ†æµ‹è¯•** - æ¯ä¸ªæ–°å­—æ®µéƒ½è¦æœ‰å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹
4. **æ—¥å¿—è®°å½•** - è·¯ç”±æ–¹æ³•è¦æœ‰è¯¦ç»†çš„æ—¥å¿—è¾“å‡º

### å›å½’æµ‹è¯•æ¸…å•
- [ ] è¿è¡Œç°æœ‰çš„ä¸ªè‚¡åˆ†ææµ‹è¯•å¥—ä»¶
- [ ] æ£€æŸ¥å¯¼å…¥agent_statesçš„æ‰€æœ‰æ¨¡å—
- [ ] éªŒè¯çŠ¶æ€åºåˆ—åŒ–/ååºåˆ—åŒ–

---

## ğŸ”— ç›¸å…³èµ„æº

- **å‚è€ƒå®ç°**ï¼š
  - `tradingagents/agents/utils/agent_states.py` - ç°æœ‰çŠ¶æ€å®šä¹‰
  - `tradingagents/graph/conditional_logic.py` - ç°æœ‰è·¯ç”±é€»è¾‘
- **æµ‹è¯•å‚è€ƒ**ï¼š
  - ç°æœ‰çš„ `tests/` ç›®å½•ä¸‹çš„æµ‹è¯•æ–‡ä»¶
- **LangGraphçŠ¶æ€æ–‡æ¡£**ï¼šhttps://langchain-ai.github.io/langgraph/concepts/low_level/#state

---

**ä¸Šä¸€é˜¶æ®µ**ï¼š[é˜¶æ®µäºŒ-AgentèŠ‚ç‚¹å®ç°](./é˜¶æ®µäºŒ-AgentèŠ‚ç‚¹å®ç°.md)  
**ä¸‹ä¸€é˜¶æ®µ**ï¼š[é˜¶æ®µå››-å›¾æ„å»ºä¸é›†æˆ](./é˜¶æ®µå››-å›¾æ„å»ºä¸é›†æˆ.md)

---

**ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2024-12-11  
**æœ€åæ›´æ–°**: 2024-12-11
