<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒé™æµ‹è¯• - TradingAgents</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .admin-only {
            background-color: #fff2f0;
            border-color: #ffccc7;
        }
        .user-only {
            background-color: #f6ffed;
            border-color: #b7eb8f;
        }
        .hidden {
            display: none;
        }
        .error {
            color: #ff4d4f;
        }
        .success {
            color: #52c41a;
        }
        .user-info {
            background-color: #e6f7ff;
            border-color: #91d5ff;
        }
    </style>
</head>
<body>
    <h1>ğŸ” æƒé™ç³»ç»Ÿæµ‹è¯•é¡µé¢</h1>

    <div class="user-info">
        <h2>å½“å‰ç”¨æˆ·ä¿¡æ¯</h2>
        <div id="userInfo">åŠ è½½ä¸­...</div>
    </div>

    <div class="test-section user-only">
        <h2>ğŸ‘¤ æ™®é€šç”¨æˆ·å†…å®¹</h2>
        <p>è¿™æ˜¯æ™®é€šç”¨æˆ·å¯ä»¥çœ‹åˆ°çš„å†…å®¹ã€‚</p>
        <ul>
            <li>é€šç”¨è®¾ç½®</li>
            <li>å¤–è§‚è®¾ç½®</li>
            <li>åˆ†æåå¥½</li>
            <li>é€šçŸ¥è®¾ç½®</li>
            <li>å®‰å…¨è®¾ç½®</li>
        </ul>
    </div>

    <div class="test-section admin-only">
        <h2>ğŸ›¡ï¸ ç®¡ç†å‘˜ä¸“å±å†…å®¹</h2>
        <p>è¿™éƒ¨åˆ†å†…å®¹åªæœ‰ç®¡ç†å‘˜æ‰èƒ½çœ‹åˆ°ï¼š</p>
        <ul>
            <li>ç³»ç»Ÿé…ç½®</li>
            <li>ä½¿ç”¨ç»Ÿè®¡</li>
            <li>ç¼“å­˜ç®¡ç†</li>
            <li>æ•°æ®åº“ç®¡ç†</li>
            <li>æ“ä½œæ—¥å¿—</li>
            <li>å¤šæ•°æ®æºåŒæ­¥</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª æµ‹è¯•è¯´æ˜</h2>
        <ol>
            <li>ä½¿ç”¨ <strong>admin</strong> è´¦å·ç™»å½•ï¼šåº”è¯¥çœ‹åˆ°æ‰€æœ‰å†…å®¹</li>
            <li>ä½¿ç”¨ <strong>user1</strong> è´¦å·ç™»å½•ï¼šåº”è¯¥åªçœ‹åˆ°æ™®é€šç”¨æˆ·å†…å®¹</li>
            <li>å¦‚æœæ™®é€šç”¨æˆ·èƒ½çœ‹åˆ°ç®¡ç†å‘˜å†…å®¹ï¼Œè¯´æ˜æƒé™æ§åˆ¶æœ‰é—®é¢˜</li>
        </ol>

        <p><button onclick="testPermissionLogic()">æµ‹è¯•æƒé™é€»è¾‘</button></p>
        <div id="testResult"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæƒé™æµ‹è¯•é€»è¾‘
        function testPermissionLogic() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<p>æµ‹è¯•æƒé™é€»è¾‘...</p>';

            // æ¨¡æ‹Ÿä¸åŒç”¨æˆ·çš„æƒé™æ£€æŸ¥
            const testUsers = [
                { username: 'admin', is_admin: true },
                { username: 'user1', is_admin: false },
                { username: 'user2', is_admin: false }
            ];

            let results = '';

            testUsers.forEach(user => {
                const isAdmin = user.is_admin;
                const canSeeAdminContent = isAdmin;

                results += `<p><strong>${user.username}</strong>: `;
                results += `is_admin=${isAdmin}, `;
                results += `å¯è§ç®¡ç†å‘˜å†…å®¹=${canSeeAdminContent} `;
                results += canSeeAdminContent === isAdmin ?
                    '<span class="success">âœ… æ­£ç¡®</span>' :
                    '<span class="error">âŒ é”™è¯¯</span>';
                results += `</p>`;
            });

            resultDiv.innerHTML = results;
        }

        // æ¨¡æ‹Ÿè·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆå®é™…åº”ç”¨ä¸­ä¼šä»APIè·å–ï¼‰
        function loadUserInfo() {
            // è¿™é‡Œæ¨¡æ‹Ÿä»localStorageè·å–ç”¨æˆ·ä¿¡æ¯
            try {
                const userInfoStr = localStorage.getItem('user-info');
                if (userInfoStr) {
                    const userInfo = JSON.parse(userInfoStr);
                    const userInfoDiv = document.getElementById('userInfo');

                    userInfoDiv.innerHTML = `
                        <p><strong>ç”¨æˆ·å:</strong> ${userInfo.username || 'Unknown'}</p>
                        <p><strong>é‚®ç®±:</strong> ${userInfo.email || 'N/A'}</p>
                        <p><strong>ç®¡ç†å‘˜:</strong> <span class="${userInfo.is_admin ? 'success' : 'error'}">${userInfo.is_admin ? 'æ˜¯' : 'å¦'}</span></p>
                        <p><strong>è§’è‰²:</strong> ${userInfo.is_admin ? 'admin' : 'user'}</p>
                    `;

                    // æ ¹æ®æƒé™æ˜¾ç¤º/éšè—å†…å®¹
                    const adminContent = document.querySelector('.admin-only');
                    if (userInfo.is_admin) {
                        adminContent.classList.remove('hidden');
                    } else {
                        adminContent.classList.add('hidden');
                    }

                } else {
                    document.getElementById('userInfo').innerHTML =
                        '<p class="error">æœªæ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œè¯·å…ˆç™»å½•</p>';
                    document.querySelector('.admin-only').classList.add('hidden');
                }
            } catch (error) {
                document.getElementById('userInfo').innerHTML =
                    `<p class="error">è¯»å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥: ${error.message}</p>`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
        });
    </script>
</body>
</html>