# ğŸ“‹ é¦–é¡µè‡ªåŠ¨åŠ è½½åˆ†æç»“æœåŠŸèƒ½

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

å®ç°äº†åœ¨Webåº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨ä»ç¼“å­˜ä¸­åŠ è½½å¹¶æ˜¾ç¤ºä¸Šä¸€æ¬¡çš„è‚¡ç¥¨åˆ†ææŠ¥å‘Šï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### 1. **æ™ºèƒ½æ¢å¤æœºåˆ¶**
- **ä¼˜å…ˆçº§ç­–ç•¥**: Session State â†’ æ–‡ä»¶ç¼“å­˜ â†’ Redisç¼“å­˜
- **æ•°æ®å®Œæ•´æ€§**: åŒæ—¶æ¢å¤åˆ†æç»“æœå’Œè¡¨å•é…ç½®
- **çŠ¶æ€ç®¡ç†**: æ­£ç¡®è®¾ç½®æ˜¾ç¤ºæ ‡å¿—ï¼Œç¡®ä¿æŠ¥å‘Šèƒ½å¤Ÿå±•ç¤º

### 2. **ç”¨æˆ·å‹å¥½çš„é¦–é¡µä½“éªŒ**
- **æ¬¢è¿æ¶ˆæ¯**: æ˜¾ç¤º"æ¬¢è¿å›æ¥ï¼å·²ä¸ºæ‚¨è‡ªåŠ¨åŠ è½½ä¸Šæ¬¡åˆ†æç»“æœ"
- **è‚¡ç¥¨ä¿¡æ¯**: æ˜¾ç¤ºè‚¡ç¥¨ä»£ç å’Œå¸‚åœºç±»å‹
- **åˆ†æID**: æ˜¾ç¤ºå®Œæ•´çš„åˆ†ææ ‡è¯†ç¬¦

### 3. **è¡¨å•é¢„å¡«åŠŸèƒ½**
- è‡ªåŠ¨æ¢å¤ä¸Šæ¬¡åˆ†æçš„è‚¡ç¥¨ä»£ç 
- æ¢å¤åˆ†ææ—¥æœŸã€åˆ†æå¸ˆé€‰æ‹©
- æ¢å¤ç ”ç©¶æ·±åº¦å’Œå¸‚åœºç±»å‹è®¾ç½®

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒä¿®æ”¹ä½ç½®
- **æ–‡ä»¶**: `web/app.py`
- **å‡½æ•°**: `initialize_session_state()`
- **æ˜¾ç¤ºé€»è¾‘**: ä¸»å‡½æ•°ä¸­çš„ç»“æœå±•ç¤ºéƒ¨åˆ†

### æ•°æ®æ¢å¤æµç¨‹

```python
# 1. æ£€æŸ¥æ˜¯å¦å·²æœ‰åˆ†æç»“æœ
if not st.session_state.analysis_results:
    
    # 2. è·å–æœ€æ–°åˆ†æID
    latest_id = get_latest_analysis_id()
    
    # 3. æ£€æŸ¥åˆ†æçŠ¶æ€
    if progress_data.get('status') == 'completed':
        
        # 4. æ¢å¤åˆ†æç»“æœï¼ˆä¼˜å…ˆæ–°æ ¼å¼ï¼‰
        if 'results' in progress_data:
            results_data = progress_data['results']
        elif 'raw_results' in progress_data:
            results_data = format_analysis_results(raw_results)
        
        # 5. æ¢å¤è¡¨å•é…ç½®
        analysis_params = progress_data.get('analysis_params', {})
        form_config = {
            'stock_symbol': analysis_params.get('stock_symbol', ''),
            'analysis_date': analysis_params.get('analysis_date', ''),
            'analysts': analysis_params.get('analysts', []),
            'research_depth': analysis_params.get('research_depth', 3),
            'market_type': analysis_params.get('market_type', 'ç¾è‚¡')
        }
        
        # 6. è®¾ç½®æ˜¾ç¤ºæ ‡å¿—
        st.session_state.should_show_results = latest_id
```

### æ˜¾ç¤ºé€»è¾‘å¢å¼º

```python
# æ–°å¢æ˜¾ç¤ºæ¡ä»¶ï¼šç³»ç»Ÿæ¢å¤æ ‡å¿—
should_show_results = (
    (analysis_results and not analysis_running and current_analysis_id) or
    (show_results_button_clicked and analysis_results) or
    (should_show_results_flag == current_analysis_id and analysis_results)  # æ–°å¢
)
```

## ğŸ“Š ç”¨æˆ·ç•Œé¢æ•ˆæœ

### é¦–æ¬¡å¯åŠ¨ï¼ˆæ— å†å²æ•°æ®ï¼‰
```
ğŸ  TradingAgents-CN è‚¡ç¥¨åˆ†æç³»ç»Ÿ
â”œâ”€â”€ ğŸ“Š è‚¡ç¥¨åˆ†æè¡¨å•
â”œâ”€â”€ â„¹ï¸ ä½¿ç”¨æŒ‡å—
â””â”€â”€ ï¼ˆæ— åˆ†ææŠ¥å‘Šæ˜¾ç¤ºï¼‰
```

### æ¢å¤å†å²åˆ†æ
```
ğŸ  TradingAgents-CN è‚¡ç¥¨åˆ†æç³»ç»Ÿ
â”œâ”€â”€ ğŸ“Š è‚¡ç¥¨åˆ†æè¡¨å•ï¼ˆé¢„å¡«ä¸Šæ¬¡é…ç½®ï¼‰
â”œâ”€â”€ â„¹ï¸ ä½¿ç”¨æŒ‡å—
â””â”€â”€ ğŸ“‹ åˆ†ææŠ¥å‘Š
    â”œâ”€â”€ âœ… æ¬¢è¿å›æ¥ï¼å·²ä¸ºæ‚¨è‡ªåŠ¨åŠ è½½ä¸Šæ¬¡åˆ†æç»“æœ (åˆ†æID: analysis_xxx)
    â”œâ”€â”€ â„¹ï¸ ğŸ“ˆ è‚¡ç¥¨: 833266 (Aè‚¡)
    â””â”€â”€ ğŸ“Š å®Œæ•´åˆ†ææŠ¥å‘Šå†…å®¹
```

## ğŸ” å…¼å®¹æ€§å¤„ç†

### æ–°æ—§æ•°æ®æ ¼å¼å…¼å®¹
- **æ–°æ ¼å¼**: ä½¿ç”¨ `progress_data['results']` å’Œ `progress_data['analysis_params']`
- **æ—§æ ¼å¼**: å›é€€åˆ° `progress_data['raw_results']` å¹¶æ ¼å¼åŒ–
- **å‚æ•°æ¢å¤**: ä¼˜å…ˆä½¿ç”¨ `analysis_params`ï¼Œå›é€€åˆ° `raw_results` ä¸­çš„å­—æ®µ

### ç¼“å­˜æœºåˆ¶é›†æˆ
- å®Œå…¨å…¼å®¹ç°æœ‰çš„ç¼“å­˜æ£€æŸ¥åŠŸèƒ½
- åˆ©ç”¨å·²æœ‰çš„ `AsyncProgressTracker` æ•°æ®ç»“æ„
- ä¸å¯¼å‡ºåŠŸèƒ½å…±äº«ç›¸åŒçš„æ•°æ®æº

## ğŸ“ æ—¥å¿—è®°å½•

ç³»ç»Ÿä¼šè¯¦ç»†è®°å½•æ¢å¤è¿‡ç¨‹ï¼š

```
ğŸ“Š [é¦–é¡µæ¢å¤] ä»åˆ†æ analysis_xxx æ¢å¤ä¸Šæ¬¡åˆ†æç»“æœ
ğŸ“Š [é¦–é¡µæ¢å¤] è‚¡ç¥¨: 833266
ğŸ” [å¸ƒå±€è°ƒè¯•] åˆ†ææŠ¥å‘Šæ˜¾ç¤ºæ£€æŸ¥:
  - analysis_resultså­˜åœ¨: True
  - analysis_running: False
  - current_analysis_id: analysis_xxx
  - should_show_results_flag: analysis_xxx
  - should_show_results: analysis_xxx
âœ… [å¸ƒå±€] åˆ†ææŠ¥å‘Šå·²æ˜¾ç¤º
```

## ğŸ‰ ç”¨æˆ·ä½“éªŒæå‡

1. **æ— ç¼ä½“éªŒ**: ç”¨æˆ·é‡æ–°æ‰“å¼€åº”ç”¨åç«‹å³çœ‹åˆ°ä¸Šæ¬¡çš„åˆ†æç»“æœ
2. **æ—¶é—´èŠ‚çœ**: æ— éœ€é‡æ–°è¾“å…¥å‚æ•°æˆ–é‡æ–°åˆ†æ
3. **å·¥ä½œè¿ç»­æ€§**: å¯ä»¥ç›´æ¥ç»§ç»­ä¸Šæ¬¡çš„å·¥ä½œæµç¨‹
4. **ä¿¡æ¯æ¸…æ™°**: æ˜ç¡®æ˜¾ç¤ºæ¢å¤çš„å†…å®¹å’Œæ¥æº

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®ä¾èµ–**: éœ€è¦æœ‰å®Œæˆçš„å†å²åˆ†æè®°å½•
2. **ç¼“å­˜æœ‰æ•ˆ**: ä¾èµ–äº Redis/æ–‡ä»¶ç¼“å­˜çš„æ•°æ®å®Œæ•´æ€§
3. **çŠ¶æ€æ¸…ç†**: åç»­æ“ä½œä¼šè‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ˜¾ç¤ºæ ‡å¿—
4. **æ€§èƒ½å½±å“**: æ¢å¤æ“ä½œåœ¨åº”ç”¨åˆå§‹åŒ–æ—¶è¿›è¡Œï¼Œä¸å½±å“è¿è¡Œæ—¶æ€§èƒ½

---

*åŠŸèƒ½å®ç°å®Œæˆæ—¶é—´: 2025å¹´8æœˆ1æ—¥*
*æµ‹è¯•çŠ¶æ€: âœ… é€šè¿‡*
*å…¼å®¹æ€§: å®Œå…¨å‘åå…¼å®¹*